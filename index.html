<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnergiX - Smart Energy Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #3b82f6;
            --dark: #1e293b;
            --darker: #0f172a;
            --light: #f1f5f9;
            --gray: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            min-height: 100vh;
            color: var(--light);
        }

        /* Container */
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .app-header {
            text-align: center;
            padding: 30px 0;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            color: var(--gray);
            margin-top: 8px;
            font-size: 0.95rem;
        }

        /* Progress Bar */
        .progress-container {
            margin: 30px 0;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .step-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .step-circle.active {
            background: var(--primary);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .step-circle.completed {
            background: var(--success);
        }

        .step-label {
            font-size: 0.7rem;
            color: var(--gray);
            text-align: center;
            max-width: 60px;
        }

        /* Card Styles */
        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        .card-subtitle {
            color: var(--gray);
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        /* AI Chat Bubble */
        .ai-bubble {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .ai-bubble::before {
            content: 'ðŸ¤–';
            position: absolute;
            top: -15px;
            left: 20px;
            background: var(--dark);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 1.2rem;
        }

        .ai-bubble p {
            line-height: 1.6;
        }

        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 10px 0;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--light);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        /* FIX: Dropdown styling for better visibility */
        .form-select {
            background-color: var(--darker);
            cursor: pointer;
        }

        .form-select option {
            background-color: var(--darker);
            color: var(--light);
            padding: 10px;
        }

        .detail-select {
            background-color: var(--darker);
            cursor: pointer;
        }

        .detail-select option {
            background-color: var(--darker);
            color: var(--light);
            padding: 10px;
        }

        /* House Type Selection */
        .house-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .house-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .house-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .house-option.selected {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .house-option i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .house-option span {
            display: block;
            font-size: 0.85rem;
        }

        /* Room Navigation */
        .room-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        .room-tab {
            padding: 12px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .room-tab:hover {
            border-color: var(--primary);
        }

        .room-tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .room-tab.completed {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--success);
        }

        .room-tab.completed::after {
            content: ' âœ“';
        }

        /* FIX: Room content visibility */
        .room-content {
            display: none;
        }

        .room-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Equipment Card */
        .equipment-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .equipment-card:hover {
            border-color: rgba(255,255,255,0.2);
        }

        .equipment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .equipment-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .equipment-name i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .equipment-toggle {
            width: 50px;
            height: 26px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .equipment-toggle.active {
            background: var(--primary);
        }

        .equipment-toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .equipment-toggle.active::after {
            left: 26px;
        }

        .equipment-details {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .equipment-details.show {
            display: grid;
        }

        .detail-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .detail-input, .detail-select {
            padding: 10px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--light);
            font-size: 0.9rem;
        }

        .detail-input:focus, .detail-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Wattage Auto-display */
        .wattage-display {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .wattage-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .wattage-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Usage Time Selection */
        .usage-time-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .time-option {
            padding: 15px 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-option:hover {
            border-color: var(--primary);
        }

        .time-option.selected {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.15);
        }

        .time-option i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .time-option.morning i { color: #fbbf24; }
        .time-option.afternoon i { color: #f97316; }
        .time-option.evening i { color: #8b5cf6; }
        .time-option.night i { color: #3b82f6; }

        .time-option span {
            font-size: 0.8rem;
        }

        /* Quantity Stepper */
        .quantity-stepper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stepper-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--light);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stepper-btn:hover {
            background: var(--primary);
        }

        .stepper-value {
            font-size: 1.1rem;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        /* Hours Slider */
        .hours-slider {
            width: 100%;
            margin-top: 10px;
        }

        .slider-container {
            position: relative;
            padding: 10px 0;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.75rem;
            color: var(--gray);
        }

        /* Analysis Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
        }

        .stat-icon.primary { background: rgba(16, 185, 129, 0.2); color: var(--primary); }
        .stat-icon.warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .stat-icon.danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .stat-icon.secondary { background: rgba(59, 130, 246, 0.2); color: var(--secondary); }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Consumption Breakdown Chart */
        .breakdown-chart {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .chart-title {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title i {
            color: var(--primary);
        }

        .breakdown-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .breakdown-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .breakdown-info {
            flex: 1;
        }

        .breakdown-name {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .breakdown-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .breakdown-value {
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 80px;
            text-align: right;
        }

        /* Solar Recommendation */
        .solar-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
        }

        .solar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .solar-icon {
            width: 60px;
            height: 60px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .solar-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .solar-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .solar-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .spec-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .spec-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }

        .spec-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--light);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        /* Add Equipment Button */
        .add-equipment-btn {
            width: 100%;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 15px;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }

        .add-equipment-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(16, 185, 129, 0.05);
        }

        /* Step Visibility */
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .app-container {
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            .house-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .usage-time-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .progress-steps {
                display: none;
            }

            .room-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .equipment-details {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Remove button for custom equipment */
        .btn-remove {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            padding: 8px 15px;
            font-size: 0.85rem;
            margin-top: 10px;
        }

        .btn-remove:hover {
            background: var(--danger);
            color: white;
        }

        /* Custom equipment name input */
        .custom-equipment-name {
            background: transparent;
            border: none;
            border-bottom: 1px dashed rgba(255,255,255,0.3);
            font-weight: 600;
            color: var(--light);
            width: 150px;
            padding: 5px;
            font-size: 1rem;
        }

        .custom-equipment-name:focus {
            outline: none;
            border-bottom-color: var(--primary);
        }

        .custom-equipment-name::placeholder {
            color: var(--gray);
        }
		
		/* Usage Pattern Card Display */
		.usage-wattage-display {
			display: flex;
			flex-direction: column;
			align-items: flex-end;
			gap: 4px;
		}

		.usage-wattage-display .wattage-value {
			font-size: 1rem;
			font-weight: 600;
			color: var(--primary);
		}

		.usage-wattage-display .daily-kwh-value {
			font-size: 0.85rem;
			color: var(--warning);
			font-weight: 500;
		}
		
		/* Energy Summary Grid */
		.energy-summary-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
			margin-top: 15px;
		}

		.summary-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 15px;
			background: rgba(255,255,255,0.03);
			border-radius: 10px;
		}

		.summary-label {
			font-size: 0.85rem;
			color: var(--gray);
		}

		.summary-value {
			font-weight: 600;
			color: var(--primary);
		}

		/* ROI Grid */
		.roi-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
			gap: 15px;
			margin-top: 15px;
		}

		.roi-item {
			display: flex;
			flex-direction: column;
			gap: 5px;
			padding: 15px;
			background: rgba(255,255,255,0.03);
			border-radius: 10px;
			text-align: center;
		}

		.roi-label {
			font-size: 0.8rem;
			color: var(--gray);
		}

		.roi-value {
			font-size: 1.2rem;
			font-weight: 700;
			color: var(--success);
		}

		/* Solar Details */
		.solar-details {
			font-size: 0.9rem;
		}
		/* Generator Section Styles */
		.generator-section .equipment-card {
			background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(239, 68, 68, 0.05));
			border-color: rgba(245, 158, 11, 0.2);
		}

		.generator-cost-display {
			background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(239, 68, 68, 0.1)) !important;
			border-color: rgba(245, 158, 11, 0.3) !important;
		}

		.total-cost-section .spec-item {
			background: rgba(239, 68, 68, 0.1);
		}

		/* Detail input styling */
		.detail-input {
			padding: 10px 12px;
			background: rgba(255,255,255,0.05);
			border: 1px solid rgba(255,255,255,0.1);
			border-radius: 8px;
			color: var(--light);
			font-size: 0.9rem;
			width: 100%;
		}

		.detail-input:focus {
			outline: none;
			border-color: var(--primary);
		}

		.detail-input::placeholder {
			color: var(--gray);
		}

		/* Number input spinner removal for cleaner look */
		.detail-input[type="number"]::-webkit-inner-spin-button,
		.detail-input[type="number"]::-webkit-outer-spin-button {
			-webkit-appearance: none;
			margin: 0;
		}

		.detail-input[type="number"] {
			-moz-appearance: textfield;
		}
		
		/* Current Costs Grid */
		.current-costs-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
			margin-top: 15px;
		}

		.cost-item {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 15px;
			background: rgba(255,255,255,0.03);
			border-radius: 10px;
		}

		.cost-item.total {
			background: rgba(239, 68, 68, 0.1);
			border: 1px solid rgba(239, 68, 68, 0.2);
		}

		.cost-item i {
			font-size: 1.5rem;
		}

		.cost-details {
			display: flex;
			flex-direction: column;
			gap: 4px;
		}

		.cost-label {
			font-size: 0.8rem;
			color: var(--gray);
		}

		.cost-value {
			font-weight: 600;
			color: var(--light);
		}

		/* ROI Section */
		.roi-comparison {
			margin-top: 15px;
		}

		.roi-section {
			padding: 20px;
			background: rgba(255,255,255,0.02);
			border-radius: 12px;
		}

		.roi-item.highlight {
			background: rgba(16, 185, 129, 0.15);
			border: 1px solid rgba(16, 185, 129, 0.3);
		}

		/* Projection Grid */
		.projection-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
			gap: 15px;
		}

		.projection-item {
			padding: 20px;
			background: rgba(255,255,255,0.03);
			border-radius: 12px;
			text-align: center;
		}

		.projection-item.current {
			background: rgba(239, 68, 68, 0.1);
			border: 1px solid rgba(239, 68, 68, 0.2);
		}

		.projection-item.solar {
			background: rgba(16, 185, 129, 0.1);
			border: 1px solid rgba(16, 185, 129, 0.2);
		}

		.projection-label {
			display: block;
			font-size: 0.85rem;
			color: var(--gray);
			margin-bottom: 10px;
		}

		.projection-value {
			display: block;
			font-size: 1.3rem;
			font-weight: 700;
			margin-bottom: 5px;
		}

		.projection-note {
			font-size: 0.75rem;
			color: var(--gray);
		}

		.savings-highlight {
			text-align: center;
		}
		
		/* Add to CSS for better mobile touch targets */
		@media (max-width: 600px) {
			.equipment-toggle {
				width: 60px;
				height: 32px;
			}
			
			.equipment-toggle::after {
				width: 28px;
				height: 28px;
			}
			
			.equipment-toggle.active::after {
				left: 30px;
			}
			
			.stepper-btn {
				width: 44px;
				height: 44px;
				font-size: 1.4rem;
			}
			
			.time-option {
				padding: 20px 10px;
			}
		}
		
		/* Add screen reader only class */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border: 0;
		}
		
		/* Add focus states for accessibility */
		.house-option:focus,
		.time-option:focus,
		.room-tab:focus {
			outline: 2px solid var(--primary);
			outline-offset: 2px;
		}

		/* Add active state for buttons */
		.btn:active {
			transform: translateY(1px);
		}

		.stepper-btn:active {
			transform: scale(0.95);
		}

		@media print {
			body {
				background: white;
				color: black;
			}
			
			.btn, .btn-group, .progress-container {
				display: none !important;
			}
			
			.card {
				border: 1px solid #ccc;
				box-shadow: none;
				break-inside: avoid;
			}
			
			.solar-card {
				background: #f5f5f5 !important;
				border: 1px solid #ccc;
			}
		}
		
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="logo">âš¡ EnergiX</h1>
            <p class="tagline">AI-Powered Energy Intelligence Platform</p>
        </header>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 14.28%;"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step">
                    <div class="step-circle active" data-step="1" aria-current="step"><span class="sr-only">Step 1 of 7: </span>1</div>
                    <span class="step-label">House</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="2" aria-current="step"><span class="sr-only">Step 2 of 7: </span>2</div>
                    <span class="step-label">Equipment</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="3" aria-current="step"><span class="sr-only">Step 3 of 7: </span>3</div>
                    <span class="step-label">Usage</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="4" aria-current="step"><span class="sr-only">Step 4 of 7: </span>4</div>
                    <span class="step-label">Analysis</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="5" aria-current="step"><span class="sr-only">Step 5 of 7: </span>5</div>
                    <span class="step-label">Location</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="6" aria-current="step"><span class="sr-only">Step 6 of 7: </span>6</div>
                    <span class="step-label">Solar</span>
                </div>
                <div class="progress-step">
                    <div class="step-circle" data-step="7" aria-current="step"><span class="sr-only">Step 7 of 7: </span>7</div>
                    <span class="step-label">Report</span>
                </div>
            </div>
        </div>

        <!-- STEP 1: House Type -->
        <div class="step-content active" id="step1">
            <div class="card">
                <div class="ai-bubble">
                    <p>ðŸ‘‹ Welcome! I'm your energy assistant. Let's discover your home's energy profile together. First, tell me about your home - this helps me understand your potential energy needs.</p>
                </div>

                <h2 class="card-title"><i class="fas fa-home"></i> What type of home do you live in?</h2>
                <p class="card-subtitle">Select the option that best describes your living space</p>

                <div class="house-grid" id="houseGrid">
                    <div class="house-option" data-value="self-contain">
                        <i class="fas fa-door-open"></i>
                        <span>Self Contain</span>
                    </div>
                    <div class="house-option" data-value="1-room-parlor">
                        <i class="fas fa-couch"></i>
                        <span>1 Room & Parlor</span>
                    </div>
                    <div class="house-option" data-value="2-bedroom">
                        <i class="fas fa-bed"></i>
                        <span>2 Bedroom Flat</span>
                    </div>
                    <div class="house-option" data-value="3-bedroom">
                        <i class="fas fa-house-user"></i>
                        <span>3 Bedroom Flat</span>
                    </div>
                    <div class="house-option" data-value="4-bedroom">
                        <i class="fas fa-building"></i>
                        <span>4 Bedroom</span>
                    </div>
                    <div class="house-option" data-value="duplex">
                        <i class="fas fa-city"></i>
                        <span>Duplex</span>
                    </div>
                    <div class="house-option" data-value="bungalow">
                        <i class="fas fa-warehouse"></i>
                        <span>Bungalow</span>
                    </div>
                    <div class="house-option" data-value="office">
                        <i class="fas fa-briefcase"></i>
                        <span>Office Space</span>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="goToStep(2)">
                        Continue <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 2: Equipment Selection -->
        <div class="step-content" id="step2">
            <div class="card">
                <div class="ai-bubble">
                    <p>Great! Now let's go room by room and identify the electrical equipment you use. I'll help estimate the power consumption for each item based on typical ratings. Toggle on the equipment you have!</p>
                </div>

                <h2 class="card-title"><i class="fas fa-plug"></i> Your Equipment</h2>
                <p class="card-subtitle">Select equipment in each room and I'll calculate the power rating</p>

                <!-- Room Tabs -->
                <div class="room-tabs" id="roomTabs">
                    <div class="room-tab active" data-room="living">Living Room</div>
                    <div class="room-tab" data-room="bedroom">Bedroom(s)</div>
                    <div class="room-tab" data-room="kitchen">Kitchen</div>
                    <div class="room-tab" data-room="bathroom">Bathroom</div>
                    <div class="room-tab" data-room="general">General</div>
                </div>

                <!-- Living Room Equipment -->
                <div class="room-content active" id="room-living">
                    <!-- TV Equipment Card -->
                    <div class="equipment-card" data-equipment="tv">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-tv"></i>
                                <span>Television</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Television"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Brand</label>
                                <select class="detail-select" data-field="brand">
                                    <option value="" disabled selected>Select Brand</option>
                                    <option value="samsung">Samsung</option>
                                    <option value="lg">LG</option>
                                    <option value="sony">Sony</option>
                                    <option value="hisense">Hisense</option>
                                    <option value="tcl">TCL</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Size</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="32">32 inches</option>
                                    <option value="43">43 inches</option>
                                    <option value="50">50 inches</option>
                                    <option value="55">55 inches</option>
                                    <option value="65">65 inches</option>
                                    <option value="75">75+ inches</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="led">LED</option>
                                    <option value="oled">OLED</option>
                                    <option value="qled">QLED</option>
                                    <option value="smart">Smart TV</option>
                                    <option value="plasma">Plasma</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Fan Equipment Card -->
                    <div class="equipment-card" data-equipment="fan">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-fan"></i>
                                <span>Living Room Fan</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Fan"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="ceiling">Ceiling Fan</option>
                                    <option value="standing">Standing Fan</option>
                                    <option value="table">Table Fan</option>
                                    <option value="exhaust">Exhaust Fan</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- AC Equipment Card -->
                    <div class="equipment-card" data-equipment="ac">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-snowflake"></i>
                                <span>Air Conditioner</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Air Conditioner"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="split">Split Unit</option>
                                    <option value="window">Window Unit</option>
                                    <option value="portable">Portable</option>
                                    <option value="inverter">Inverter AC</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Capacity</label>
                                <select class="detail-select" data-field="capacity">
                                    <option value="">Select Size</option>
                                    <option value="1">1 HP</option>
                                    <option value="1.5">1.5 HP</option>
                                    <option value="2">2 HP</option>
                                    <option value="2.5">2.5 HP</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Light Bulbs -->
                    <div class="equipment-card" data-equipment="livingroom-bulb">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-lightbulb"></i>
                                <span>Light Bulbs</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Light Bulbs"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
									<option value="">Select Type</option>
                                    <option value="led">LED Bulb</option>
                                    <option value="energy-saving">Energy Saving</option>
                                    <option value="incandescent">Incandescent</option>
                                    <option value="fluorescent">Fluorescent</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Wattage</label>
                                <select class="detail-select" data-field="wattage">
									<option value="">Select Rating</option>
                                    <option value="5">5W</option>
                                    <option value="9">9W</option>
                                    <option value="12">12W</option>
                                    <option value="15">15W</option>
                                    <option value="20">20W</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>
					

                    <!-- Sound System -->
                    <div class="equipment-card" data-equipment="sound">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-volume-up"></i>
                                <span>Sound System/Speaker</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Sound System"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="soundbar">Soundbar</option>
                                    <option value="home-theater">Home Theater</option>
                                    <option value="bluetooth">Bluetooth Speaker</option>
                                    <option value="hifi">Hi-Fi System</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Add Custom Equipment -->
                    <button class="add-equipment-btn" data-room="living">
                        <i class="fas fa-plus"></i>
                        Add Custom Equipment
                    </button>
                </div>

                <!-- Bedroom Equipment -->
                <div class="room-content" id="room-bedroom">
                    <!-- Bedroom TV -->
                    <div class="equipment-card" data-equipment="bedroom-tv">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-tv"></i>
                                <span>Bedroom Television</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Television"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Brand</label>
                                <select class="detail-select" data-field="brand">
                                    <option value="" disabled selected>Select Brand</option>
                                    <option value="samsung">Samsung</option>
                                    <option value="lg">LG</option>
                                    <option value="sony">Sony</option>
                                    <option value="hisense">Hisense</option>
                                    <option value="tcl">TCL</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Size</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="32">32 inches</option>
                                    <option value="43">43 inches</option>
                                    <option value="50">50 inches</option>
                                    <option value="55">55 inches</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="led">LED</option>
                                    <option value="smart">Smart TV</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bedroom AC -->
                    <div class="equipment-card" data-equipment="bedroom-ac">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-snowflake"></i>
                                <span>Bedroom Air Conditioner</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Air Conditioner"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="split">Split Unit</option>
                                    <option value="window">Window Unit</option>
                                    <option value="inverter">Inverter AC</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Capacity</label>
                                <select class="detail-select" data-field="capacity">
                                    <option value="">Select Size</option>
                                    <option value="1">1 HP</option>
                                    <option value="1.5">1.5 HP</option>
                                    <option value="2">2 HP</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bedroom Fan -->
                    <div class="equipment-card" data-equipment="bedroom-fan">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-fan"></i>
                                <span>Bedroom Fan</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Fan"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="ceiling">Ceiling Fan</option>
                                    <option value="standing">Standing Fan</option>
                                    <option value="table">Table Fan</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bedroom Light Bulbs -->
                    <div class="equipment-card" data-equipment="bedroom-bulb">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-lightbulb"></i>
                                <span>Bedroom Light Bulbs</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Bulbs"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
									<option value="">Select Type</option>
                                    <option value="led">LED Bulb</option>
                                    <option value="energy-saving">Energy Saving</option>
                                    <option value="incandescent">Incandescent</option>
                                    <option value="fluorescent">Fluorescent</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Wattage</label>
                                <select class="detail-select" data-field="wattage">
									<option value="">Select Rating</option>
                                    <option value="5">5W</option>
                                    <option value="9">9W</option>
                                    <option value="12">12W</option>
                                    <option value="15">15W</option>
                                    <option value="20">20W</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Total Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Phone Charger -->
                    <div class="equipment-card" data-equipment="charger">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Phone/Device Chargers</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Phone Chargers"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="standard">Standard (5W)</option>
                                    <option value="fast">Fast Charger (18W)</option>
                                    <option value="super-fast">Super Fast (45W)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>
					
					<!-- Laptop -->
                    <div class="equipment-card" data-equipment="laptop">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-laptop"></i>
                                <span>Laptop</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Laptop"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select"  data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="ultrabook">Ultrabook (45W)</option>
                                    <option value="standard">Standard (65W)</option>
                                    <option value="gaming">Gaming Laptop (150W)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <button class="add-equipment-btn" data-room="bedroom">
                        <i class="fas fa-plus"></i>
                        Add Custom Equipment
                    </button>
                </div>

                <!-- Kitchen Equipment -->
                <div class="room-content" id="room-kitchen">
                    <!-- Refrigerator -->
                    <div class="equipment-card" data-equipment="refrigerator">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-temperature-low"></i>
                                <span>Refrigerator</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Refrigerator"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="single-door">Single Door</option>
                                    <option value="double-door">Double Door</option>
                                    <option value="side-by-side">Side by Side</option>
                                    <option value="mini">Mini Fridge</option>
                                    <option value="inverter">Inverter Fridge</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Size (Litres)</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="100">Under 100L</option>
                                    <option value="200">100-200L</option>
                                    <option value="300">200-300L</option>
                                    <option value="400">300-400L</option>
                                    <option value="500">400L+</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Freezer -->
                    <div class="equipment-card" data-equipment="freezer">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-snowflake"></i>
                                <span>Freezer</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Freezer"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="chest">Chest Freezer</option>
                                    <option value="upright">Upright Freezer</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Size (Litres)</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="100">Under 100L</option>
                                    <option value="200">100-200L</option>
                                    <option value="300">200-300L</option>
                                    <option value="400">300L+</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Microwave -->
                    <div class="equipment-card" data-equipment="microwave">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-fire"></i>
                                <span>Microwave</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Microwave"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Size</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="small">Small (20L)</option>
                                    <option value="medium">Medium (25-30L)</option>
                                    <option value="large">Large (30L+)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Electric Kettle -->
                    <div class="equipment-card" data-equipment="kettle">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-mug-hot"></i>
                                <span>Electric Kettle</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Kettle"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Size</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="small">Small (1L)</option>
                                    <option value="medium">Medium (1.5-2L)</option>
                                    <option value="large">Large (2L+)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Blender -->
                    <div class="equipment-card" data-equipment="blender">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-blender"></i>
                                <span>Blender</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Blender"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="small">Small/Personal</option>
                                    <option value="medium">Medium</option>
                                    <option value="large">Large/Commercial</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Electric Cooker -->
                    <div class="equipment-card" data-equipment="cooker">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-fire-alt"></i>
                                <span>Electric Cooker/Hot Plate</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Cooker"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="single">Single Burner</option>
                                    <option value="double">Double Burner</option>
                                    <option value="induction">Induction Cooker</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Kitchen Light -->
                    <div class="equipment-card" data-equipment="kitchen-bulb">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-lightbulb"></i>
                                <span>Kitchen Light Bulbs</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Bulbs"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
									<option value="">Select Type</option>
                                    <option value="led">LED Bulb</option>
                                    <option value="energy-saving">Energy Saving</option>
                                    <option value="incandescent">Incandescent</option>
                                    <option value="fluorescent">Fluorescent</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Wattage</label>
                                <select class="detail-select" data-field="wattage">
									<option value="">Select Rating</option>
                                    <option value="5">5W</option>
                                    <option value="9">9W</option>
                                    <option value="12">12W</option>
                                    <option value="15">15W</option>
                                    <option value="20">20W</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Total Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <button class="add-equipment-btn" data-room="kitchen">
                        <i class="fas fa-plus"></i>
                        Add Kitchen Appliance
                    </button>
                </div>

                <!-- Bathroom Equipment -->
                <div class="room-content" id="room-bathroom">
                    <!-- Water Heater -->
                    <div class="equipment-card" data-equipment="water-heater">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-hot-tub"></i>
                                <span>Water Heater</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Heater"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="instant">Instant Water Heater</option>
                                    <option value="storage-25">Storage (25L)</option>
                                    <option value="storage-50">Storage (50L)</option>
                                    <option value="storage-100">Storage (100L)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bathroom Light -->
                    <div class="equipment-card" data-equipment="bathroom-bulb">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-lightbulb"></i>
                                <span>Bathroom Light Bulbs</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Bulbs"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
									<option value="">Select Type</option>
                                    <option value="led">LED Bulb</option>
                                    <option value="energy-saving">Energy Saving</option>
                                    <option value="incandescent">Incandescent</option>
                                    <option value="fluorescent">Fluorescent</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Wattage</label>
                                <select class="detail-select" data-field="wattage">
									<option value="">Select Rating</option>
                                    <option value="5">5W</option>
                                    <option value="9">9W</option>
                                    <option value="12">12W</option>
                                    <option value="15">15W</option>
                                    <option value="20">20W</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Total Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    
                    <!-- Hair Dryer -->
                    <div class="equipment-card" data-equipment="hair-dryer">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-wind"></i>
                                <span>Hair Dryer</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Hair Dryer"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="standard">Standard</option>
                                    <option value="professional">Professional</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Exhaust Fan -->
                    <div class="equipment-card" data-equipment="exhaust-fan">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-fan"></i>
                                <span>Exhaust Fan</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Exhaust Fan"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Size</label>
                                <select class="detail-select" data-field="size">
                                    <option value="">Select Size</option>
                                    <option value="small">Small (6-8 inch)</option>
                                    <option value="medium">Medium (10-12 inch)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <button class="add-equipment-btn" data-room="bathroom">
                        <i class="fas fa-plus"></i>
                        Add Bathroom Equipment
                    </button>
                </div>

                <!-- General Equipment -->
                <div class="room-content" id="room-general">
                    <!-- Washing Machine -->
                    <div class="equipment-card" data-equipment="washing-machine">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-tshirt"></i>
                                <span>Washing Machine</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Washing Machine"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="top-manual">Top Load (Manual)</option>
                                    <option value="top-auto">Top Load (Automatic)</option>
                                    <option value="front-auto">Front Load (Automatic)</option>
                                    <option value="front-inverter">Front Load (Inverter)</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Iron -->
                    <div class="equipment-card" data-equipment="iron">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-tshirt"></i>
                                <span>Pressing Iron</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Iron"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="">Select Type</option>
                                    <option value="dry">Dry Iron</option>
                                    <option value="steam">Steam Iron</option>
                                    <option value="cordless">Cordless Iron</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Water Pump -->
                    <div class="equipment-card" data-equipment="water-pump">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-water"></i>
                                <span>Water Pump</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Pump"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Capacity</label>
                                <select class="detail-select" data-field="capacity">
                                    <option value="">Select Capacity</option>
                                    <option value="0.5">0.5 HP</option>
                                    <option value="1">1 HP</option>
                                    <option value="1.5">1.5 HP</option>
                                    <option value="2">2 HP</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
									<button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Router/Modem -->
                    <div class="equipment-card" data-equipment="router">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-wifi"></i>
                                <span>WiFi Router/Modem</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Router"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="router">Standard Router</option>
                                    <option value="modem-router">Modem + Router</option>
                                    <option value="mesh">Mesh System</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- DSTV/Decoder -->
                    <div class="equipment-card" data-equipment="decoder">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-satellite-dish"></i>
                                <span>DSTV/Cable Decoder</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Cable Decoder"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="dstv">DSTV</option>
                                    <option value="gotv">GOTV</option>
                                    <option value="startimes">StarTimes</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Security Lights -->
                    <div class="equipment-card" data-equipment="security-light">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-lightbulb"></i>
                                <span>Security/Outdoor Lights</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Outdoor Lights"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="led">LED Flood Light</option>
                                    <option value="halogen">Halogen</option>
                                    <option value="sensor">Motion Sensor Light</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Wattage</label>
                                <select class="detail-select" data-field="wattage">
                                    <option value="10">10W</option>
                                    <option value="20">20W</option>
                                    <option value="30">30W</option>
                                    <option value="50">50W</option>
                                    <option value="100">100W</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">2</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Total Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <!-- Desktop Computer -->
                    <div class="equipment-card" data-equipment="desktop">
                        <div class="equipment-header">
                            <div class="equipment-name">
                                <i class="fas fa-desktop"></i>
                                <span>Desktop Computer</span>
                            </div>
                            <!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false" 
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Desktop"
								 tabindex="0"></div>
                        </div>
                        <div class="equipment-details">
                            <div class="detail-group">
                                <label class="detail-label">Type</label>
                                <select class="detail-select" data-field="type">
                                    <option value="basic">Basic/Office</option>
                                    <option value="gaming">Gaming PC</option>
                                    <option value="workstation">Workstation</option>
                                </select>
                            </div>
                            <div class="detail-group">
                                <label class="detail-label">Quantity</label>
                                <div class="quantity-stepper">
                                    <button class="stepper-btn" data-action="decrease">-</button>
                                    <span class="stepper-value">1</span>
                                    <button class="stepper-btn" data-action="increase">+</button>
                                </div>
                            </div>
                            <div class="wattage-display" style="grid-column: 1 / -1;">
                                <span class="wattage-label">Estimated Power Rating</span>
                                <span class="wattage-value">-- W</span>
                            </div>
                        </div>
                    </div>

                    <button class="add-equipment-btn" data-room="general">
                        <i class="fas fa-plus"></i>
                        Add Other Equipment
                    </button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep(1)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(3)">
                        Continue to Usage <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Steps 3-7 remain the same as before -->
        <!-- STEP 3: Usage Patterns -->
        <div class="step-content" id="step3">
            <div class="card">
                <div class="ai-bubble">
                    <p>Excellent! Now I need to understand when and how long you use each equipment. This helps me calculate your peak consumption hours and estimate accurate energy costs.</p>
                </div>
                <h2 class="card-title"><i class="fas fa-clock"></i> Usage Patterns</h2>
                <p class="card-subtitle">This section will be dynamically populated based on your equipment selections</p>
                
                <div id="usage-patterns-container">
                    <!-- Will be populated dynamically -->
                    <p style="color: var(--gray); text-align: center; padding: 40px;">
                        <i class="fas fa-info-circle"></i> Your selected equipment usage patterns will appear here.
                    </p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep(2)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(4)">
                        View My Analysis <i class="fas fa-chart-bar"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 4: Analysis Dashboard -->
        <div class="step-content" id="step4">
            <div class="card">
                <div class="ai-bubble">
                    <p>ðŸŽ‰ Analysis complete! Here's a comprehensive breakdown of your home's energy profile.</p>
                </div>
                <h2 class="card-title"><i class="fas fa-chart-pie"></i> Your Energy Profile</h2>
                <div id="analysis-dashboard">
                    <!-- Will be populated dynamically -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep(3)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(5)">
                        Calculate Costs <i class="fas fa-money-bill"></i>
                    </button>
                </div>
            </div>
        </div>

		<!-- STEP 5: Location & Power Company -->
		<div class="step-content" id="step5">
			<div class="card">
				<div class="ai-bubble">
					<p>Now let's estimate your electricity costs! Tell me your location and power distribution company, and I'll fetch the current tariff rates to give you an accurate monthly bill estimate.</p>
				</div>

				<h2 class="card-title"><i class="fas fa-map-marker-alt"></i> Location & Utility</h2>
				<p class="card-subtitle">Select your state and power distribution company</p>

				<div class="form-group">
					<label class="form-label">State</label>
					<select class="form-select" id="stateSelect">
						<option value="">Select your state</option>
						<option value="lagos">Lagos</option>
						<option value="abuja">Abuja (FCT)</option>
						<option value="rivers">Rivers</option>
						<option value="kano">Kano</option>
						<option value="oyo">Oyo</option>
						<option value="delta">Delta</option>
						<option value="kaduna">Kaduna</option>
						<option value="enugu">Enugu</option>
						<option value="anambra">Anambra</option>
						<option value="edo">Edo</option>
					</select>
				</div>

				<div class="form-group">
					<label class="form-label">Distribution Company (DisCo)</label>
					<select class="form-select" id="discoSelect">
						<option value="">Select your DisCo</option>
						<option value="ekedc">Eko Electricity (EKEDC)</option>
						<option value="ikedc">Ikeja Electric (IKEDC)</option>
						<option value="aedc">Abuja Electricity (AEDC)</option>
						<option value="phedc">Port Harcourt Electric (PHEDC)</option>
						<option value="kedco">Kano Electricity (KEDCO)</option>
						<option value="ibedc">Ibadan Electricity (IBEDC)</option>
						<option value="bedc">Benin Electricity (BEDC)</option>
						<option value="eedc">Enugu Electricity (EEDC)</option>
					</select>
				</div>

				<div class="form-group">
					<label class="form-label">Tariff Band (if known)</label>
					<select class="form-select" id="tariffBand">
						<option value="">Select tariff band</option>
						<option value="a">Band A (20+ hours supply)</option>
						<option value="b">Band B (16-20 hours supply)</option>
						<option value="c">Band C (12-16 hours supply)</option>
						<option value="d">Band D (8-12 hours supply)</option>
						<option value="e">Band E (4-8 hours supply)</option>
					</select>
				</div>

				<div class="form-group">
					<label class="form-label">Average daily power supply hours</label>
					<div class="slider-container">
						<input type="range" class="slider" min="0" max="24" value="12" id="powerHours">
						<div class="slider-labels">
							<span>0h</span>
							<span>6h</span>
							<span>12h</span>
							<span>18h</span>
							<span>24h</span>
						</div>
					</div>
					<p style="text-align: center; margin-top: 10px; color: var(--primary);">
						<strong id="power-hours-display">12</strong> hours daily
					</p>
				</div>

				<!-- Generator Section -->
				<div class="generator-section" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
					<div class="equipment-card">
						<div class="equipment-header">
							<div class="equipment-name">
								<i class="fas fa-gas-pump"></i>
								<span>Do you use a Generator?</span>
							</div>
							<!-- Equipment toggle should have accessible label -->
							<div class="equipment-toggle" 
								 data-active="false"
								 id="generatorToggle"
								 role="switch" 
								 aria-checked="false"
								 aria-label="Toggle Generator"
								 tabindex="0"></div>
						</div>
						
						<div class="equipment-details" id="generatorDetails" style="display: none;">
							<div class="detail-group">
								<label class="detail-label">Generator Size</label>
								<select class="detail-select" id="generatorSize">
									<option value="">Select Size</option>
									<option value="1">Small (0.5 - 1 kVA)</option>
									<option value="2.5">Medium (2 - 3 kVA)</option>
									<option value="5">Large (5 - 6.5 kVA)</option>
									<option value="10">Extra Large (8 - 10 kVA)</option>
									<option value="15">Industrial (12 - 15 kVA)</option>
									<option value="20">Industrial (18 - 20+ kVA)</option>
								</select>
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Fuel Type</label>
								<select class="detail-select" id="fuelType">
									<option value="petrol">Petrol (PMS)</option>
									<option value="diesel">Diesel (AGO)</option>
								</select>
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Usage Frequency</label>
								<select class="detail-select" id="generatorFrequency">
									<option value="daily">Daily</option>
									<option value="weekdays">Weekdays Only</option>
									<option value="weekends">Weekends Only</option>
									<option value="few-times">Few times a week</option>
									<option value="rarely">Rarely (few times a month)</option>
								</select>
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Hours per Use</label>
								<select class="detail-select" id="generatorHours">
									<option value="1">1-2 hours</option>
									<option value="3">3-4 hours</option>
									<option value="5" selected>5-6 hours</option>
									<option value="8">7-8 hours</option>
									<option value="10">9-10 hours</option>
									<option value="12">10+ hours</option>
								</select>
							</div>
							
							<div class="detail-group" style="grid-column: 1 / -1;">
								<label class="form-label">Average hours per day when used: <strong id="gen-hours-display">5</strong> hours</label>
								<div class="slider-container">
									<input type="range" class="slider" min="1" max="24" value="5" id="generatorHoursSlider">
									<div class="slider-labels">
										<span>1h</span>
										<span>6h</span>
										<span>12h</span>
										<span>18h</span>
										<span>24h</span>
									</div>
								</div>
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Current Fuel Price (â‚¦/Litre)</label>
								<input type="number" class="detail-input" id="fuelPrice" placeholder="e.g., 700" value="700">
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Litres per Fill</label>
								<input type="number" class="detail-input" id="litresPerFill" placeholder="e.g., 10" value="10">
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Fills per Week</label>
								<select class="detail-select" id="fillsPerWeek">
									<option value="1">Once a week</option>
									<option value="2" selected>Twice a week</option>
									<option value="3">3 times a week</option>
									<option value="4">4 times a week</option>
									<option value="5">5 times a week</option>
									<option value="7">Daily</option>
								</select>
							</div>
							
							<!-- Generator Cost Summary -->
							<div class="wattage-display generator-cost-display" style="grid-column: 1 / -1; flex-direction: column; align-items: stretch; gap: 10px;">
								<div style="display: flex; justify-content: space-between;">
									<span class="wattage-label">Weekly Fuel Cost</span>
									<span class="wattage-value" id="weeklyFuelCost">â‚¦14,000</span>
								</div>
								<div style="display: flex; justify-content: space-between;">
									<span class="wattage-label">Monthly Fuel Cost</span>
									<span class="wattage-value" id="monthlyFuelCost" style="color: var(--warning);">â‚¦56,000</span>
								</div>
								<div style="display: flex; justify-content: space-between;">
									<span class="wattage-label">Annual Fuel Cost</span>
									<span class="wattage-value" id="annualFuelCost" style="color: var(--danger);">â‚¦672,000</span>
								</div>
							</div>
							
							<!-- Generator Maintenance Info -->
							<div class="ai-bubble" style="grid-column: 1 / -1; margin-top: 10px;">
								<p style="font-size: 0.85rem;">ðŸ’¡ <strong>Tip:</strong> Don't forget generator maintenance costs! Oil changes, servicing, and repairs typically add <strong>â‚¦5,000 - â‚¦15,000</strong> monthly depending on usage.</p>
							</div>
							
							<div class="detail-group">
								<label class="detail-label">Est. Monthly Maintenance (â‚¦)</label>
								<input type="number" class="detail-input" id="generatorMaintenance" placeholder="e.g., 10000" value="10000">
							</div>
						</div>
					</div>
				</div>

				<!-- Cost Estimate Card -->
				<div class="solar-card" id="costEstimateCard" style="margin-top: 25px;">
					<div class="solar-header">
						<div class="solar-icon">ðŸ’°</div>
						<div>
							<h3 class="solar-title">Estimated Monthly Energy Cost</h3>
							<p class="solar-subtitle" id="costSubtitle">Based on Band B tariff @ â‚¦63/kWh</p>
						</div>
					</div>
					<div class="solar-specs" id="gridCostSpecs">
						<div class="spec-item">
							<div class="spec-value" id="currentGridCost">â‚¦0</div>
							<div class="spec-label" id="currentGridLabel">Grid (12hrs)</div>
						</div>
						<div class="spec-item">
							<div class="spec-value" id="fullDayGridCost">â‚¦0</div>
							<div class="spec-label">Grid (24hrs)</div>
						</div>
						<div class="spec-item">
							<div class="spec-value" id="bandACost">â‚¦0</div>
							<div class="spec-label">If Band A</div>
						</div>
					</div>
					
					<!-- Generator Cost Addition (shown when generator is active) -->
					<div id="generatorCostSection" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
						<h4 style="margin-bottom: 15px; color: var(--warning);"><i class="fas fa-gas-pump"></i> Generator Costs</h4>
						<div class="solar-specs">
							<div class="spec-item">
								<div class="spec-value" id="genMonthlyCost" style="color: var(--warning);">â‚¦0</div>
								<div class="spec-label">Monthly Fuel</div>
							</div>
							<div class="spec-item">
								<div class="spec-value" id="genMaintenanceCost" style="color: var(--warning);">â‚¦0</div>
								<div class="spec-label">Maintenance</div>
							</div>
							<div class="spec-item">
								<div class="spec-value" id="genTotalCost" style="color: var(--danger);">â‚¦0</div>
								<div class="spec-label">Total Gen Cost</div>
							</div>
						</div>
					</div>
					
					<!-- Total Combined Cost -->
					<div class="total-cost-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
						<div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.3);">
							<div>
								<span style="font-size: 0.9rem; color: var(--gray);">Total Monthly Energy Cost</span>
								<p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">(Grid + Generator)</p>
							</div>
							<div style="text-align: right;">
								<span id="totalMonthlyCost" style="font-size: 1.8rem; font-weight: 700; color: var(--danger);">â‚¦0</span>
								<p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;"><span id="totalAnnualCost">â‚¦0</span>/year</p>
							</div>
						</div>
					</div>
				</div>

				<div class="btn-group">
					<button class="btn btn-secondary" onclick="goToStep(4)">
						<i class="fas fa-arrow-left"></i> Back
					</button>
					<button class="btn btn-primary" onclick="goToStep(6)">
						Solar Options <i class="fas fa-solar-panel"></i>
					</button>
				</div>
			</div>
		</div>

        <!-- STEP 6: Solar -->
        <div class="step-content" id="step6">
            <div class="card">
                <div class="ai-bubble">
                    <p>ðŸŒž Based on your energy profile, here are my solar system recommendations.</p>
                </div>
                <h2 class="card-title"><i class="fas fa-solar-panel"></i> Solar Recommendations</h2>
                <div id="solar-recommendations">
                    <!-- Will be populated dynamically -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep(5)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(7)">
                        Get My Report <i class="fas fa-file-pdf"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 7: Report -->
        <div class="step-content" id="step7">
            <div class="card">
                <div class="ai-bubble">
                    <p>ðŸŽŠ Your personalized energy report is ready! Enter your details to receive it.</p>
                </div>
                <h2 class="card-title"><i class="fas fa-file-alt"></i> Get Your Free Report</h2>
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="userName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="userEmail" placeholder="Enter your email address">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="userPhone" placeholder="Enter your phone number">
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep(6)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" style="flex: 1;" onclick="submitForm()">
                        <i class="fas fa-paper-plane"></i> Send My Report
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // APPLICATION STATE
        // ==========================================
        let currentStep = 1;
        const totalSteps = 7;

        const appState = {
            houseType: null,
            equipment: {},
            usagePatterns: {},
            location: {},
            contactInfo: {}
        };

        // ==========================================
        // EQUIPMENT DATABASE (Wattage Values)
        // ==========================================
        const equipmentDatabase = {
            tv: {
                samsung: { 
                    32: { led: 35, smart: 40, oled: 45 }, 
                    43: { led: 55, smart: 60, oled: 70 }, 
                    50: { led: 70, smart: 80, qled: 100 },
                    55: { led: 80, smart: 90, qled: 120, oled: 130 }, 
                    65: { led: 100, smart: 120, qled: 150, oled: 160 },
                    75: { led: 130, smart: 150, qled: 180, oled: 200 }
                },
                lg: { 
                    32: { led: 33, smart: 38 }, 
                    43: { led: 50, smart: 58 }, 
                    50: { led: 65, smart: 75, oled: 90 },
                    55: { led: 75, smart: 85, oled: 130 }, 
                    65: { led: 95, smart: 110, oled: 160 },
                    75: { led: 125, smart: 140, oled: 190 }
                },
                sony: { 
                    43: { led: 60, smart: 70 }, 
                    50: { led: 75, smart: 85 },
                    55: { led: 90, smart: 100, oled: 140 }, 
                    65: { led: 110, smart: 130, oled: 170 },
                    75: { led: 140, smart: 160, oled: 210 }
                },
                hisense: { 
                    32: { led: 30, smart: 35 }, 
                    43: { led: 45, smart: 50 }, 
                    50: { led: 60, smart: 70 },
                    55: { led: 70, smart: 80 },
                    65: { led: 90, smart: 100 }
                },
                tcl: { 
                    32: { led: 28, smart: 33 }, 
                    43: { led: 42, smart: 48 }, 
                    50: { led: 55, smart: 65 },
                    55: { led: 65, smart: 75 },
                    65: { led: 85, smart: 95 }
                },
                other: { 
                    32: { led: 35, smart: 40, plasma: 100 }, 
                    43: { led: 55, smart: 60, plasma: 150 }, 
                    50: { led: 70, smart: 80, plasma: 180 },
                    55: { led: 80, smart: 90, plasma: 200 }, 
                    65: { led: 100, smart: 120, plasma: 250 },
                    75: { led: 130, smart: 150, plasma: 300 }
                }
            },
            ac: {
                split: { 1: 900, 1.5: 1350, 2: 1800, 2.5: 2250 },
                window: { 1: 1000, 1.5: 1500, 2: 2000 },
                inverter: { 1: 600, 1.5: 900, 2: 1200, 2.5: 1500 },
                portable: { 1: 1100, 1.5: 1650, 2: 2200 }
            },
            fan: {
                ceiling: 75,
                standing: 65,
                table: 45,
                exhaust: 40
            },
            refrigerator: {
                'single-door': { 100: 80, 200: 100, 300: 120, 400: 140, 500: 160 },
                'double-door': { 100: 100, 200: 150, 300: 180, 400: 200, 500: 250 },
                'side-by-side': { 200: 180, 300: 220, 400: 250, 500: 300 },
                'mini': { 100: 60, 200: 80 },
                'inverter': { 100: 50, 200: 80, 300: 100, 400: 120, 500: 140 }
            },
            freezer: {
                'chest': { 100: 80, 200: 120, 300: 150, 400: 180 },
                'upright': { 100: 90, 200: 130, 300: 160, 400: 200 }
            },
            microwave: {
                small: 800,
                medium: 1000,
                large: 1200
            },
            kettle: {
                small: 1500,
                medium: 1800,
                large: 2200
            },
            blender: {
                small: 300,
                medium: 500,
                large: 800
            },
            cooker: {
                single: 1000,
                double: 2000,
                induction: 1800
            },
            'water-heater': {
                instant: 3000,
                'storage-25': 1500,
                'storage-50': 2000,
                'storage-100': 3000
            },
            'hair-dryer': {
                standard: 1200,
                professional: 1800
            },
            'exhaust-fan': {
                small: 25,
                medium: 40
            },
            'washing-machine': {
                'top-manual': 350,
                'top-auto': 500,
                'front-auto': 500,
                'front-inverter': 300
            },
            iron: {
                dry: 1000,
                steam: 1400,
                cordless: 1800
            },
            'water-pump': {
                0.5: 370,
                1: 750,
                1.5: 1100,
                2: 1500
            },
            router: {
                router: 12,
                'modem-router': 15,
                mesh: 25
            },
            decoder: {
                dstv: 25,
                gotv: 15,
                startimes: 15,
                other: 20
            },
            'security-light': {
                led: 'wattage-based',
                halogen: 'wattage-based',
                sensor: 'wattage-based'
            },
            desktop: {
                basic: 150,
                gaming: 400,
                workstation: 300
            },
            sound: {
                soundbar: 50,
                'home-theater': 150,
                bluetooth: 20,
                hifi: 100
            },
            bulb: {
                led: 'wattage-based',
                'energy-saving': 'wattage-based',
                incandescent: 'wattage-based',
                fluorescent: 'wattage-based'
            },
			charger: {
				standard: 5,
				fast: 18,
				'super-fast': 45
			},
			laptop: {
				ultrabook: 45,
				standard: 65,
				gaming: 150
			}
        };

        // ==========================================
        // NAVIGATION FUNCTIONS
        // ==========================================
        function updateStepCircles(activeStep) {
            const circles = document.querySelectorAll('.step-circle');
            circles.forEach((circle, index) => {
                const stepNum = index + 1;
                circle.classList.remove('active', 'completed');
                
                if (stepNum < activeStep) {
                    circle.classList.add('completed');
                    circle.innerHTML = '<i class="fas fa-check"></i>';
                } else if (stepNum === activeStep) {
                    circle.classList.add('active');
                    circle.textContent = stepNum;
                } else {
                    circle.textContent = stepNum;
                }
            });
        }

        function validateCurrentStep() {
            if (currentStep === 1 && !appState.houseType) {
                alert('Please select your house type');
                return false;
            }
            return true;
        }

        // ==========================================
        // HOUSE TYPE SELECTION
        // ==========================================
        document.getElementById('houseGrid').addEventListener('click', function(e) {
            const option = e.target.closest('.house-option');
            if (!option) return;

            // Remove selected from all
            document.querySelectorAll('.house-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selected to clicked
            option.classList.add('selected');
            appState.houseType = option.dataset.value;
        });

        // ==========================================
        // ROOM TAB NAVIGATION
        // ==========================================
        document.getElementById('roomTabs').addEventListener('click', function(e) {
            const tab = e.target.closest('.room-tab');
            if (!tab) return;

            const roomId = tab.dataset.room;

            // Update active tab
            document.querySelectorAll('.room-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            // Show corresponding room content
            document.querySelectorAll('.room-content').forEach(content => {
                content.classList.remove('active');
            });

            const roomContent = document.getElementById(`room-${roomId}`);
            if (roomContent) {
                roomContent.classList.add('active');
            }
        });

        // ==========================================
        // EQUIPMENT TOGGLE
        // ==========================================
        document.addEventListener('click', function(e) {
            const toggle = e.target.closest('.equipment-toggle');
            if (!toggle) return;

            const isActive = toggle.dataset.active === 'true';
            toggle.dataset.active = (!isActive).toString();
            toggle.classList.toggle('active');

            const card = toggle.closest('.equipment-card');
            const details = card.querySelector('.equipment-details');
            
            if (!isActive) {
                details.classList.add('show');
            } else {
                details.classList.remove('show');
            }

            // Update equipment state
            updateEquipmentState(card);
        });
		
		// Update toggle click handler to support keyboard
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Enter' || e.key === ' ') {
				const toggle = e.target.closest('.equipment-toggle');
				if (toggle) {
					e.preventDefault();
					toggle.click();
				}
			}
		});

		// Update aria-checked when toggling
		const isActive = toggle.dataset.active === 'true';
		toggle.setAttribute('aria-checked', (!isActive).toString());

        // ==========================================
        // QUANTITY STEPPER
        // ==========================================
        document.addEventListener('click', function(e) {
            const stepperBtn = e.target.closest('.stepper-btn');
            if (!stepperBtn) return;

            const stepper = stepperBtn.closest('.quantity-stepper');
            const valueDisplay = stepper.querySelector('.stepper-value');
            let currentValue = parseInt(valueDisplay.textContent);

            if (stepperBtn.dataset.action === 'increase') {
                currentValue++;
            } else if (stepperBtn.dataset.action === 'decrease' && currentValue > 1) {
                currentValue--;
            }

            valueDisplay.textContent = currentValue;

            // Recalculate wattage
            const card = stepperBtn.closest('.equipment-card');
            calculateAndDisplayWattage(card);
            updateEquipmentState(card);
        });

        // ==========================================
        // DROPDOWN CHANGE HANDLER
        // ==========================================
        document.addEventListener('change', function(e) {
            const select = e.target.closest('.detail-select');
            if (!select) return;

            const card = select.closest('.equipment-card');
            calculateAndDisplayWattage(card);
            updateEquipmentState(card);
        });

        // ==========================================
        // WATTAGE CALCULATION
        // ==========================================
        function calculateAndDisplayWattage(card) {
			if (!card) return;
			
			const equipmentType = card.dataset.equipment;
			const selects = card.querySelectorAll('.detail-select');
			const quantityEl = card.querySelector('.stepper-value');
			const wattageDisplay = card.querySelector('.wattage-value');

			if (!wattageDisplay) return;

			const quantity = quantityEl ? parseInt(quantityEl.textContent) : 1;
			
			// If no equipment type, try to calculate from direct wattage input
			if (!equipmentType) {
				const wattageInput = card.querySelector('input[data-field="wattage"]');
				const wattageSelect = card.querySelector('select[data-field="wattage"]');
				
				if (wattageInput) {
					const wattage = parseInt(wattageInput.value) || 0;
					const total = wattage * quantity;
					wattageDisplay.textContent = total > 0 ? `${total.toLocaleString()} W` : '-- W';
				} else if (wattageSelect) {
					const wattage = parseInt(wattageSelect.value) || 0;
					const total = wattage * quantity;
					wattageDisplay.textContent = total > 0 ? `${total.toLocaleString()} W` : '-- W';
				}
				return;
			}
			
			// Collect all selected values
			const values = {};
			selects.forEach(select => {
				const field = select.dataset.field;
				if (field) {
					values[field] = select.value;
				}
			});

			let wattage = calculateWattage(equipmentType, values);
			
			if (wattage > 0) {
				const totalWattage = wattage * quantity;
				wattageDisplay.textContent = `${totalWattage.toLocaleString()} W`;
			} else {
				wattageDisplay.textContent = '-- W';
			}
		}

        function calculateWattage(equipmentType, values) {
			let wattage = 0;
			
			// Guard against undefined equipmentType
			if (!equipmentType) {
				if (values && values.wattage) {
					return parseInt(values.wattage);
				}
				return 0;
			}
			
			// Normalize equipment type (remove room prefix like "bedroom-")
			const baseType = equipmentType.replace(/^(bedroom|kitchen|bathroom|general|livingroom)-/, '');
			
            switch (baseType) {
                case 'tv':
                    const brand = values.brand || 'other';
                    const size = values.size;
                    const tvType = values.type;
                    
                    if (brand && size && tvType && 
                        equipmentDatabase.tv[brand] && 
                        equipmentDatabase.tv[brand][size] && 
                        equipmentDatabase.tv[brand][size][tvType]) {
                        wattage = equipmentDatabase.tv[brand][size][tvType];
                    }
                    break;

                case 'ac':
                    const acType = values.type;
                    const capacity = values.capacity;
                    
                    if (acType && capacity && 
                        equipmentDatabase.ac[acType] && 
                        equipmentDatabase.ac[acType][capacity]) {
                        wattage = equipmentDatabase.ac[acType][capacity];
                    }
                    break;

                case 'fan':
                    const fanType = values.type;
                    if (fanType && equipmentDatabase.fan[fanType]) {
                        wattage = equipmentDatabase.fan[fanType];
                    }
                    break;

                case 'refrigerator':
                    const fridgeType = values.type;
                    const fridgeSize = values.size;
                    
                    if (fridgeType && fridgeSize && 
                        equipmentDatabase.refrigerator[fridgeType] && 
                        equipmentDatabase.refrigerator[fridgeType][fridgeSize]) {
                        wattage = equipmentDatabase.refrigerator[fridgeType][fridgeSize];
                    }
                    break;

                case 'freezer':
                    const freezerType = values.type;
                    const freezerSize = values.size;
                    
                    if (freezerType && freezerSize && 
                        equipmentDatabase.freezer[freezerType] && 
                        equipmentDatabase.freezer[freezerType][freezerSize]) {
                        wattage = equipmentDatabase.freezer[freezerType][freezerSize];
                    }
                    break;

                case 'microwave':
                    if (values.size && equipmentDatabase.microwave[values.size]) {
                        wattage = equipmentDatabase.microwave[values.size];
                    }
                    break;

                case 'kettle':
                    if (values.size && equipmentDatabase.kettle[values.size]) {
                        wattage = equipmentDatabase.kettle[values.size];
                    }
                    break;

                case 'blender':
                    if (values.type && equipmentDatabase.blender[values.type]) {
                        wattage = equipmentDatabase.blender[values.type];
                    }
                    break;

                case 'cooker':
                    if (values.type && equipmentDatabase.cooker[values.type]) {
                        wattage = equipmentDatabase.cooker[values.type];
                    }
                    break;

                case 'water-heater':
                    if (values.type && equipmentDatabase['water-heater'][values.type]) {
                        wattage = equipmentDatabase['water-heater'][values.type];
                    }
                    break;

                case 'hair-dryer':
                    if (values.type && equipmentDatabase['hair-dryer'][values.type]) {
                        wattage = equipmentDatabase['hair-dryer'][values.type];
                    }
                    break;

                case 'exhaust-fan':
                    if (values.size && equipmentDatabase['exhaust-fan'][values.size]) {
                        wattage = equipmentDatabase['exhaust-fan'][values.size];
                    }
                    break;

                case 'washing-machine':
                    if (values.type && equipmentDatabase['washing-machine'][values.type]) {
                        wattage = equipmentDatabase['washing-machine'][values.type];
                    }
                    break;

                case 'iron':
                    if (values.type && equipmentDatabase.iron[values.type]) {
                        wattage = equipmentDatabase.iron[values.type];
                    }
                    break;

                case 'water-pump':
                    if (values.capacity && equipmentDatabase['water-pump'][values.capacity]) {
                        wattage = equipmentDatabase['water-pump'][values.capacity];
                    }
                    break;

                case 'router':
                    if (values.type && equipmentDatabase.router[values.type]) {
                        wattage = equipmentDatabase.router[values.type];
                    }
                    break;

                case 'decoder':
                    if (values.type && equipmentDatabase.decoder[values.type]) {
                        wattage = equipmentDatabase.decoder[values.type];
                    }
                    break;

                case 'desktop':
                    if (values.type && equipmentDatabase.desktop[values.type]) {
                        wattage = equipmentDatabase.desktop[values.type];
                    }
                    break;

                case 'sound':
                    if (values.type && equipmentDatabase.sound[values.type]) {
                        wattage = equipmentDatabase.sound[values.type];
                    }
                    break;
					
				// Add inside the switch statement in calculateWattage function
				case 'charger':
					if (values.type && equipmentDatabase.charger[values.type]) {
						wattage = equipmentDatabase.charger[values.type];
					}
					break;

				case 'laptop':
					if (values.type && equipmentDatabase.laptop[values.type]) {
						wattage = equipmentDatabase.laptop[values.type];
					}
					break;

                case 'bulb':
                    // For bulbs, use the wattage field directly
                    if (values.wattage) {
                        wattage = parseInt(values.wattage);
                    }
                    break;

                case 'security-light':
                    // For security lights, use the wattage field directly
                    if (values.wattage) {
                        wattage = parseInt(values.wattage);
                    }
                    break;

                default:
                    // For custom equipment or unknown types
                    if (values.wattage) {
                        wattage = parseInt(values.wattage);
                    }
                    break;
            }

            return wattage;
        }

        // ==========================================
        // UPDATE EQUIPMENT STATE
        // ==========================================
        function updateEquipmentState(card) {
			if (!card) return;
			
			const equipmentId = card.dataset.equipment;
			if (!equipmentId) return;
			
			const toggle = card.querySelector('.equipment-toggle');
			if (!toggle) return;
			
			const isActive = toggle.dataset.active === 'true';

			if (!isActive) {
				delete appState.equipment[equipmentId];
				return;
			}

			const selects = card.querySelectorAll('.detail-select');
			const quantityEl = card.querySelector('.stepper-value');
			const wattageDisplay = card.querySelector('.wattage-value');

			const values = {};
			selects.forEach(select => {
				const field = select.dataset.field;
				if (field) {
					values[field] = select.value;
				}
			});

			const quantity = quantityEl ? parseInt(quantityEl.textContent) : 1;
			const wattageText = wattageDisplay ? wattageDisplay.textContent : '0 W';
			const wattage = parseInt(wattageText.replace(/[^0-9]/g, '')) || 0;

			// Get equipment name - handle both span and input elements
			const nameSpan = card.querySelector('.equipment-name span');
			const nameInput = card.querySelector('.equipment-name input');
			let equipmentName = 'Custom Equipment';

			if (nameSpan) {
				equipmentName = nameSpan.textContent;
			} else if (nameInput) {
				equipmentName = nameInput.value || 'Custom Equipment';
			}

			appState.equipment[equipmentId] = {
				name: equipmentName,
				values: values,
				quantity: quantity,
				wattage: wattage
			};
		}

        // ==========================================
        // ADD CUSTOM EQUIPMENT
        // ==========================================
        document.addEventListener('click', function(e) {
            const addBtn = e.target.closest('.add-equipment-btn');
            if (!addBtn) return;

            const roomId = addBtn.dataset.room;
            const customId = `custom-${Date.now()}`;

            const customCard = document.createElement('div');
            customCard.className = 'equipment-card';
            customCard.dataset.equipment = customId;
            customCard.innerHTML = `
                <div class="equipment-header">
                    <div class="equipment-name">
                        <i class="fas fa-plug"></i>
                        <input type="text" class="custom-equipment-name" placeholder="Equipment name" data-field="name">
                    </div>
                    <div class="equipment-toggle active" data-active="true"></div>
                </div>
                <div class="equipment-details show">
                    <div class="detail-group">
                        <label class="detail-label">Power Rating (Watts)</label>
                        <input type="number" class="detail-input" placeholder="e.g., 100" data-field="wattage">
                    </div>
                    <div class="detail-group">
                        <label class="detail-label">Quantity</label>
                        <div class="quantity-stepper">
                            <button class="stepper-btn" data-action="decrease">-</button>
                            <span class="stepper-value">1</span>
                            <button class="stepper-btn" data-action="increase">+</button>
                        </div>
                    </div>
                    <div class="wattage-display" style="grid-column: 1 / -1;">
                        <span class="wattage-label">Total Power Rating</span>
                        <span class="wattage-value">-- W</span>
                    </div>
                </div>
                <button class="btn btn-remove" onclick="removeEquipment(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            `;

            addBtn.parentNode.insertBefore(customCard, addBtn);

            // Add event listener for custom wattage input
            const wattageInput = customCard.querySelector('input[data-field="wattage"]');
            wattageInput.addEventListener('input', function() {
				// ADD: Validate input
				let value = parseInt(this.value) || 0;
				
				// Prevent negative values
				if (value < 0) {
					value = 0;
					this.value = 0;
				}
				
				// Cap at reasonable maximum
				if (value > 50000) {
					value = 50000;
					this.value = 50000;
				}
				
				const quantity = parseInt(customCard.querySelector('.stepper-value').textContent) || 1;
				const total = value * quantity;
				customCard.querySelector('.wattage-value').textContent = total > 0 ? `${total.toLocaleString()} W` : '-- W';
				updateEquipmentState(customCard);
			});
        });

        function removeEquipment(btn) {
            const card = btn.closest('.equipment-card');
            const equipmentId = card.dataset.equipment;
            delete appState.equipment[equipmentId];
            card.remove();
        }

        // ==========================================
		// GENERATE USAGE PATTERNS (Step 3) - UPDATED
		// ==========================================
		function generateUsagePatterns() {
			const container = document.getElementById('usage-patterns-container');
			const equipmentList = Object.entries(appState.equipment);

			if (equipmentList.length === 0) {
				container.innerHTML = `
					<div class="ai-bubble">
						<p>âš ï¸ You haven't selected any equipment yet. Please go back and select at least one piece of equipment.</p>
					</div>
				`;
				return;
			}

			let html = '';
			equipmentList.forEach(([id, equip]) => {
				const defaultHours = getDefaultHours(id);
				const defaultPeriods = getDefaultPeriods(id);
				const dailyWh = equip.wattage * defaultHours;
				const dailyKwh = (dailyWh / 1000).toFixed(2);

				html += `
					<div class="equipment-card" data-usage-equipment="${id}" data-base-wattage="${equip.wattage}">
						<div class="equipment-header">
							<div class="equipment-name">
								<i class="fas fa-clock"></i>
								<span>${equip.name} ${equip.quantity > 1 ? `(Ã—${equip.quantity})` : ''}</span>
							</div>
							<div class="usage-wattage-display">
								<span class="wattage-value">${equip.wattage.toLocaleString()} W</span>
								<span class="daily-kwh-value">${dailyKwh} kWh/day</span>
							</div>
						</div>

						<div class="form-group">
							<label class="form-label">When do you typically use this?</label>
							<div class="usage-time-grid">
								<div class="time-option morning ${defaultPeriods.includes('morning') ? 'selected' : ''}" data-period="morning" data-hours="6">
									<i class="fas fa-sun"></i>
									<span>Morning<br>(6AM-12PM)</span>
								</div>
								<div class="time-option afternoon ${defaultPeriods.includes('afternoon') ? 'selected' : ''}" data-period="afternoon" data-hours="5">
									<i class="fas fa-cloud-sun"></i>
									<span>Afternoon<br>(12PM-5PM)</span>
								</div>
								<div class="time-option evening ${defaultPeriods.includes('evening') ? 'selected' : ''}" data-period="evening" data-hours="5">
									<i class="fas fa-moon"></i>
									<span>Evening<br>(5PM-10PM)</span>
								</div>
								<div class="time-option night ${defaultPeriods.includes('night') ? 'selected' : ''}" data-period="night" data-hours="8">
									<i class="fas fa-star"></i>
									<span>Night<br>(10PM-6AM)</span>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label class="form-label">Average hours per day: <strong class="hours-display">${defaultHours}</strong> hours</label>
							<div class="slider-container">
								<input type="range" class="slider hours-slider" min="0" max="24" value="${defaultHours}" data-equipment-id="${id}">
								<div class="slider-labels">
									<span>0h</span>
									<span>6h</span>
									<span>12h</span>
									<span>18h</span>
									<span>24h</span>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label class="form-label">Usage Frequency</label>
							<select class="form-select frequency-select" data-equipment-id="${id}">
								<option value="daily" selected>Daily</option>
								<option value="weekdays">Weekdays Only (5 days/week)</option>
								<option value="weekends">Weekends Only (2 days/week)</option>
								<option value="few-times">Few times a week (3 days/week)</option>
								<option value="monthly">Few times a month (4 days/month)</option>
							</select>
						</div>
					</div>
				`;
			});

			container.innerHTML = html;

			// Instead of adding listeners in generateUsagePatterns(), 
			// use event delegation on the container:

			document.getElementById('usage-patterns-container').addEventListener('input', function(e) {
				if (e.target.classList.contains('hours-slider')) {
					const card = e.target.closest('.equipment-card');
					updateUsageCardDisplay(card, parseInt(e.target.value));
				}
			});

			document.getElementById('usage-patterns-container').addEventListener('change', function(e) {
				if (e.target.classList.contains('frequency-select')) {
					const card = e.target.closest('.equipment-card');
					const hours = parseInt(card.querySelector('.hours-slider').value);
					updateUsageCardDisplay(card, hours);
				}
			});

			document.getElementById('usage-patterns-container').addEventListener('click', function(e) {
				if (e.target.closest('.time-option')) {
					const option = e.target.closest('.time-option');
					option.classList.toggle('selected');
					const card = option.closest('.equipment-card');
					recalculateHoursFromPeriods(card);
				}
			});
		}

		function updateUsageCardDisplay(card, hours) {
			const baseWattage = parseInt(card.dataset.baseWattage);
			const frequencySelect = card.querySelector('.frequency-select');
			const frequency = frequencySelect ? frequencySelect.value : 'daily';
			
			// Update hours display
			card.querySelector('.hours-display').textContent = hours;
			
			// Calculate daily kWh based on frequency
			let freqMultiplier = 1;
			switch(frequency) {
				case 'weekdays': freqMultiplier = 5/7; break;
				case 'weekends': freqMultiplier = 2/7; break;
				case 'few-times': freqMultiplier = 3/7; break;
				case 'monthly': freqMultiplier = 4/30; break;
				default: freqMultiplier = 1;
			}
			
			const dailyWh = baseWattage * hours * freqMultiplier;
			const dailyKwh = (dailyWh / 1000).toFixed(2);
			
			// Update the daily kWh display
			const kwhDisplay = card.querySelector('.daily-kwh-value');
			if (kwhDisplay) {
				kwhDisplay.textContent = `${dailyKwh} kWh/day`;
			}
		}

		function recalculateHoursFromPeriods(card) {
			const selectedPeriods = card.querySelectorAll('.time-option.selected');
			let totalHours = 0;
			
			selectedPeriods.forEach(period => {
				totalHours += parseInt(period.dataset.hours) || 0;
			});
			
			// Cap at 24 hours
			totalHours = Math.min(totalHours, 24);
			
			// Update slider
			const slider = card.querySelector('.hours-slider');
			slider.value = totalHours;
			
			// Update display
			updateUsageCardDisplay(card, totalHours);
		}
		
		function getDefaultHours(equipmentId) {
			const defaults = {
				'refrigerator': 8,
				'freezer': 8,
				'router': 24,
				'decoder': 8,
				'bulb': 5,
				'livingroom-bulb': 5,  // ADD THIS
				'bedroom-bulb': 4,
				'kitchen-bulb': 2,
				'bathroom-bulb': 1,
				'security-light': 10,
				'tv': 4,
				'bedroom-tv': 3,
				'ac': 6,
				'bedroom-ac': 8,
				'fan': 8,
				'bedroom-fan': 8,
				'charger': 3,
				'laptop': 4,
				'microwave': 0.5,
				'kettle': 0.5,
				'blender': 0.25,
				'cooker': 2,
				'water-heater': 1,
				'hair-dryer': 0.25,
				'exhaust-fan': 2,
				'washing-machine': 1,
				'iron': 1,
				'water-pump': 1,
				'sound': 3,
				'desktop': 4
			};
			return defaults[equipmentId] || 4;
		}

		function getDefaultPeriods(equipmentId) {
			const defaults = {
				'refrigerator': ['morning', 'afternoon', 'evening', 'night'],
				'freezer': ['morning', 'afternoon', 'evening', 'night'],
				'router': ['morning', 'afternoon', 'evening', 'night'],
				'decoder': ['morning', 'afternoon', 'evening', 'night'],
				'bulb': ['evening', 'night'],
				'livingroom-bulb': ['evening', 'night'],  // ADD
				'bedroom-bulb': ['evening', 'night'],
				'bathroom-bulb': ['evening', 'night'],
				'kitchen-bulb': ['evening', 'night'],
				'security-light': ['evening', 'night'],
				'tv': ['evening'],
				'bedroom-tv': ['night'],
				'ac': ['afternoon', 'night'],
				'bedroom-ac': ['night'],
				'fan': ['afternoon', 'evening', 'night'],
				'bedroom-fan': ['afternoon', 'evening', 'night'],
				'charger': ['night'],
				'laptop': ['morning', 'afternoon', 'evening'],
				'microwave': ['morning', 'evening'],
				'kettle': ['morning', 'evening'],
				'blender': ['morning'],
				'cooker': ['morning', 'evening'],
				'water-heater': ['morning', 'evening'],
				'hair-dryer': ['morning'],
				'exhaust-fan': ['morning', 'evening'],
				'washing-machine': ['morning'],
				'iron': ['morning', 'afternoon'],
				'water-pump': ['morning', 'evening'],
				'sound': ['evening'],
				'desktop': ['morning', 'afternoon', 'evening']
			};
			return defaults[equipmentId] || ['evening'];
		}

        // ==========================================
// STEP 4: ANALYSIS DASHBOARD - COMPLETE
// ==========================================
function generateAnalysisDashboard() {
    // First collect usage data from Step 3
    collectUsageData();

    const container = document.getElementById('analysis-dashboard');
    const analysis = calculateEnergyAnalysis();

    // Store analysis in appState for later steps
    appState.analysis = analysis;

    container.innerHTML = `
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-icon primary">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="stat-value">${analysis.dailyKwh.toFixed(2)} kWh</div>
                <div class="stat-label">Daily Consumption</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon danger">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="stat-value">${(analysis.peakLoad / 1000).toFixed(2)} kW</div>
                <div class="stat-label">Peak Load</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="stat-value">${(analysis.baseLoad / 1000).toFixed(2)} kW</div>
                <div class="stat-label">Base Load (24/7)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon secondary">
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="stat-value">${analysis.monthlyKwh.toFixed(0)} kWh</div>
                <div class="stat-label">Monthly Estimate</div>
            </div>
        </div>

        <div class="breakdown-chart">
            <h3 class="chart-title"><i class="fas fa-list"></i> Consumption by Equipment</h3>
            ${generateBreakdownItems(analysis.breakdown)}
        </div>

        <div class="breakdown-chart" style="margin-top: 20px;">
            <h3 class="chart-title"><i class="fas fa-clock"></i> Peak Consumption Hours</h3>
            <div class="ai-bubble">
                <p>âš¡ Your highest energy usage occurs during <strong>${analysis.peakPeriod}</strong>. 
                ${analysis.peakEquipment ? `Your <strong>${analysis.peakEquipment}</strong> is your biggest energy consumer.` : ''}
                ${analysis.peakTip}</p>
            </div>
        </div>

        <div class="breakdown-chart" style="margin-top: 20px;">
            <h3 class="chart-title"><i class="fas fa-info-circle"></i> Energy Summary</h3>
            <div class="energy-summary-grid">
                <div class="summary-item">
                    <span class="summary-label">Highest Hourly Consumption</span>
                    <span class="summary-value">${(analysis.peakLoad / 1000).toFixed(2)} kWh</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Lowest Hourly Consumption</span>
                    <span class="summary-value">${(analysis.baseLoad / 1000).toFixed(3)} kWh</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Average Hourly Consumption</span>
                    <span class="summary-value">${(analysis.dailyKwh / 24).toFixed(3)} kWh</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Weekly Estimate</span>
                    <span class="summary-value">${(analysis.dailyKwh * 7).toFixed(1)} kWh</span>
                </div>
            </div>
        </div>
    `;
}

function collectUsageData() {
    document.querySelectorAll('[data-usage-equipment]').forEach(card => {
        const equipmentId = card.dataset.usageEquipment;
        const slider = card.querySelector('.hours-slider');
        const frequencySelect = card.querySelector('.frequency-select');
        
        const hours = slider ? parseInt(slider.value) : 4;
        const frequency = frequencySelect ? frequencySelect.value : 'daily';
        const periods = Array.from(card.querySelectorAll('.time-option.selected'))
            .map(opt => opt.dataset.period);

        appState.usagePatterns[equipmentId] = {
            hours: hours,
            frequency: frequency,
            periods: periods
        };
    });
}

function calculateEnergyAnalysis() {
	try{
    let dailyKwh = 0;
    let peakLoad = 0;
    let baseLoad = 0;
    let breakdown = [];
    let periodLoads = { morning: 0, afternoon: 0, evening: 0, night: 0 };

    Object.entries(appState.equipment).forEach(([id, equip]) => {
        const usage = appState.usagePatterns[id] || { hours: 4, frequency: 'daily', periods: ['evening'] };
        
        // Frequency multiplier
        let freqMultiplier = 1;
        switch(usage.frequency) {
            case 'weekdays': freqMultiplier = 5/7; break;
            case 'weekends': freqMultiplier = 2/7; break;
            case 'few-times': freqMultiplier = 3/7; break;
            case 'monthly': freqMultiplier = 4/30; break;
            default: freqMultiplier = 1;
        }

        const dailyWh = equip.wattage * usage.hours * freqMultiplier;
        dailyKwh += dailyWh / 1000;

        // Peak load is when everything could run simultaneously
        peakLoad += equip.wattage;

        // Base load is 24/7 equipment
        if (usage.hours === 24 || ['refrigerator', 'freezer', 'router'].some(type => id.includes(type))) {
            baseLoad += equip.wattage;
        }

        // Period loads
        usage.periods.forEach(period => {
            periodLoads[period] += equip.wattage;
        });

        breakdown.push({
            id: id,
            name: equip.name,
            wattage: equip.wattage,
            hours: usage.hours,
            frequency: usage.frequency,
            dailyKwh: dailyWh / 1000,
            percentage: 0
        });
    });

    // Calculate percentages
    breakdown.forEach(item => {
        item.percentage = dailyKwh > 0 ? (item.dailyKwh / dailyKwh * 100) : 0;
    });

    // Sort by consumption
    breakdown.sort((a, b) => b.dailyKwh - a.dailyKwh);

    // Find peak period
    const peakPeriodEntry = Object.entries(periodLoads).sort((a, b) => b[1] - a[1])[0];
    const periodNames = {
        morning: 'morning hours (6AM-12PM)',
        afternoon: 'afternoon hours (12PM-5PM)',
        evening: 'evening hours (5PM-10PM)',
        night: 'nighttime (10PM-6AM)'
    };

    // Find peak equipment
    const peakEquipment = breakdown.length > 0 ? breakdown[0].name : null;

    // Generate tip based on peak equipment
    let peakTip = 'Consider shifting some usage to off-peak hours to balance your load.';
    if (peakEquipment) {
        if (peakEquipment.toLowerCase().includes('ac') || peakEquipment.toLowerCase().includes('air conditioner')) {
            peakTip = 'Consider using an inverter AC or setting higher temperature (24-26Â°C) to reduce consumption by up to 40%.';
        } else if (peakEquipment.toLowerCase().includes('refrigerator') || peakEquipment.toLowerCase().includes('freezer')) {
            peakTip = 'Ensure proper ventilation around your fridge and avoid frequent door opening to optimize efficiency.';
        } else if (peakEquipment.toLowerCase().includes('water heater')) {
            peakTip = 'Consider using a timer to heat water only when needed, or switch to solar water heating.';
        }
    }

    return {
        dailyKwh: dailyKwh,
        monthlyKwh: dailyKwh * 30,
        peakLoad: peakLoad,
        baseLoad: baseLoad,
        breakdown: breakdown,
        periodLoads: periodLoads,
        peakPeriod: periodNames[peakPeriodEntry[0]],
        peakEquipment: peakEquipment,
        peakTip: peakTip
    };
} catch (error) {
        console.error('Error calculating energy analysis:', error);
        return {
            dailyKwh: 0,
            monthlyKwh: 0,
            peakLoad: 0,
            baseLoad: 0,
            breakdown: [],
            periodLoads: { morning: 0, afternoon: 0, evening: 0, night: 0 },
            peakPeriod: 'evening hours',
            peakEquipment: null,
            peakTip: 'Unable to calculate tips at this time.'
        };
    }
}


function generateBreakdownItems(breakdown) {
    const colors = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#ef4444', '#ec4899', '#06b6d4', '#84cc16'];
    const icons = {
        'tv': 'fa-tv',
        'ac': 'fa-snowflake',
        'fan': 'fa-fan',
        'bulb': 'fa-lightbulb',
        'refrigerator': 'fa-temperature-low',
        'freezer': 'fa-snowflake',
        'microwave': 'fa-fire',
        'kettle': 'fa-mug-hot',
        'iron': 'fa-tshirt',
        'washing': 'fa-tshirt',
        'pump': 'fa-water',
        'router': 'fa-wifi',
        'decoder': 'fa-satellite-dish',
        'laptop': 'fa-laptop',
        'desktop': 'fa-desktop',
        'charger': 'fa-mobile-alt',
        'heater': 'fa-hot-tub',
        'default': 'fa-plug'
    };

    return breakdown.slice(0, 8).map((item, index) => {
        // Find appropriate icon
        let iconClass = icons.default;
        for (const [key, value] of Object.entries(icons)) {
            if (item.id.toLowerCase().includes(key) || item.name.toLowerCase().includes(key)) {
                iconClass = value;
                break;
            }
        }

        return `
            <div class="breakdown-item">
                <div class="breakdown-icon">
                    <i class="fas ${iconClass}" style="color: ${colors[index % colors.length]};"></i>
                </div>
                <div class="breakdown-info">
                    <div class="breakdown-name">${item.name}</div>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" style="width: ${Math.min(item.percentage, 100)}%; background: linear-gradient(90deg, ${colors[index % colors.length]}, ${colors[(index + 1) % colors.length]});"></div>
                    </div>
                </div>
                <div class="breakdown-value">${item.dailyKwh.toFixed(2)} kWh (${item.percentage.toFixed(0)}%)</div>
            </div>
        `;
    }).join('');
}

// ==========================================
// STEP 5: LOCATION & COST CALCULATION (UPDATED WITH GENERATOR)
// ==========================================
const tariffRates = {
    a: { rate: 225, minHours: 20, name: 'Band A' },
    b: { rate: 63, minHours: 16, name: 'Band B' },
    c: { rate: 53, minHours: 12, name: 'Band C' },
    d: { rate: 48, minHours: 8, name: 'Band D' },
    e: { rate: 43, minHours: 4, name: 'Band E' }
};

const discoStates = {
    'ekedc': ['lagos'],
    'ikedc': ['lagos'],
    'aedc': ['abuja', 'niger', 'kogi', 'nasarawa'],
    'phedc': ['rivers', 'bayelsa', 'cross-river', 'akwa-ibom'],
    'kedco': ['kano', 'jigawa', 'katsina'],
    'ibedc': ['oyo', 'ogun', 'osun', 'kwara'],
    'bedc': ['edo', 'delta', 'ondo', 'ekiti'],
    'eedc': ['enugu', 'anambra', 'imo', 'abia', 'ebonyi']
};

// Generator fuel consumption rates (litres per hour based on load)
const generatorFuelConsumption = {
    1: { petrol: 0.5, diesel: 0.4 },      // Small gen
    2.5: { petrol: 0.8, diesel: 0.6 },    // Medium gen
    5: { petrol: 1.2, diesel: 0.9 },      // Large gen
    10: { petrol: 2.0, diesel: 1.5 },     // Extra large
    15: { petrol: 3.0, diesel: 2.2 },     // Industrial
    20: { petrol: 4.0, diesel: 3.0 }      // Large industrial
};

function initializeStep5() {
    const stateSelect = document.getElementById('stateSelect');
    const discoSelect = document.getElementById('discoSelect');
    const tariffSelect = document.getElementById('tariffBand');
    const powerHoursSlider = document.getElementById('powerHours');
    const generatorToggle = document.getElementById('generatorToggle');

    // Auto-select DisCo based on state
    if (stateSelect) {
        stateSelect.addEventListener('change', function() {
            const state = this.value.toLowerCase();
            for (const [disco, states] of Object.entries(discoStates)) {
                if (states.includes(state)) {
                    discoSelect.value = disco;
                    break;
                }
            }
            updateAllCosts();
        });
    }

    // Update cost when tariff changes
    if (tariffSelect) {
        tariffSelect.addEventListener('change', updateAllCosts);
    }

    // Update cost when power hours changes
    if (powerHoursSlider) {
        powerHoursSlider.addEventListener('input', function() {
            document.getElementById('power-hours-display').textContent = this.value;
            updateAllCosts();
        });
    }

    // Generator toggle
	if (generatorToggle) {
		generatorToggle.addEventListener('click', function() {
			const isActive = this.dataset.active === 'true';
			const newState = !isActive;
			this.dataset.active = newState.toString();
			this.classList.toggle('active');
			
			const details = document.getElementById('generatorDetails');
			const genCostSection = document.getElementById('generatorCostSection');
			
			if (newState) {
				// Generator is now ON
				details.classList.add('show');
				details.style.display = 'grid';
				genCostSection.style.display = 'block';
			} else {
				// Generator is now OFF
				details.classList.remove('show');
				details.style.display = 'none';
				genCostSection.style.display = 'none';
			}
			
			updateAllCosts();
		});
	}

    // Generator hours slider
    const genHoursSlider = document.getElementById('generatorHoursSlider');
    if (genHoursSlider) {
        genHoursSlider.addEventListener('input', function() {
            document.getElementById('gen-hours-display').textContent = this.value;
            updateGeneratorCosts();
            updateAllCosts();
        });
    }

    // Generator input change listeners
    const generatorInputs = [
        'generatorSize', 'fuelType', 'generatorFrequency', 
        'fuelPrice', 'litresPerFill', 'fillsPerWeek', 'generatorMaintenance'
    ];
    
    generatorInputs.forEach(inputId => {
        const element = document.getElementById(inputId);
        if (element) {
            element.addEventListener('change', function() {
                updateGeneratorCosts();
                updateAllCosts();
            });
            element.addEventListener('input', function() {
                updateGeneratorCosts();
                updateAllCosts();
            });
        }
    });
	
	// ADD: Check if generator was previously enabled
    if (appState.costEstimate?.useGenerator) {
        const toggle = document.getElementById('generatorToggle');
        const details = document.getElementById('generatorDetails');
        const genCostSection = document.getElementById('generatorCostSection');
        
        toggle.dataset.active = 'true';
        toggle.classList.add('active');
        details.classList.add('show');
        details.style.display = 'grid';
        genCostSection.style.display = 'block';
    }

    // Initial calculations
    updateAllCosts();
}

function updateGeneratorCosts() {
    const generatorToggle = document.getElementById('generatorToggle');
    const useGenerator = generatorToggle?.dataset.active === 'true';
    
    // If generator is not enabled, return zeros
    if (!useGenerator) {
        return {
            weekly: 0,
            monthly: 0,
            annual: 0
        };
    }
    
    const fuelPrice = parseFloat(document.getElementById('fuelPrice')?.value) || 700;
    const litresPerFill = parseFloat(document.getElementById('litresPerFill')?.value) || 10;
    const fillsPerWeek = parseFloat(document.getElementById('fillsPerWeek')?.value) || 2;
    
    const weeklyFuelCost = fuelPrice * litresPerFill * fillsPerWeek;
    const monthlyFuelCost = weeklyFuelCost * 4.33; // Average weeks per month
    const annualFuelCost = monthlyFuelCost * 12;
    
    // Update displays in generator section
    const weeklyDisplay = document.getElementById('weeklyFuelCost');
    const monthlyDisplay = document.getElementById('monthlyFuelCost');
    const annualDisplay = document.getElementById('annualFuelCost');
    
    if (weeklyDisplay) weeklyDisplay.textContent = `â‚¦${formatNumber(weeklyFuelCost)}`;
    if (monthlyDisplay) monthlyDisplay.textContent = `â‚¦${formatNumber(monthlyFuelCost)}`;
    if (annualDisplay) annualDisplay.textContent = `â‚¦${formatNumber(annualFuelCost)}`;
    
    return {
        weekly: weeklyFuelCost,
        monthly: monthlyFuelCost,
        annual: annualFuelCost
    };
}    

function updateAllCosts() {
    const tariffSelect = document.getElementById('tariffBand');
    const powerHoursSlider = document.getElementById('powerHours');
    const generatorToggle = document.getElementById('generatorToggle');
    
    const band = tariffSelect?.value || 'b';
    const powerHours = powerHoursSlider ? parseInt(powerHoursSlider.value) : 12;
    const useGenerator = generatorToggle?.dataset.active === 'true';
    
    // Get analysis data
    const analysis = appState.analysis || { dailyKwh: 15, monthlyKwh: 450 };
    
    // Get tariff rate
    const tariff = tariffRates[band] || tariffRates.b;
    
    // Calculate grid costs
    const adjustedDailyKwh = (analysis.dailyKwh / 24) * powerHours;
    const adjustedMonthlyKwh = adjustedDailyKwh * 30;
    
    const currentGridCost = adjustedMonthlyKwh * tariff.rate;
    const fullDayGridCost = analysis.monthlyKwh * tariff.rate;
    const bandACost = analysis.monthlyKwh * tariffRates.a.rate;

    // Update grid cost displays
    document.getElementById('costSubtitle').textContent = `Based on ${tariff.name} tariff @ â‚¦${tariff.rate}/kWh`;
    document.getElementById('currentGridCost').textContent = `â‚¦${formatNumber(currentGridCost)}`;
    document.getElementById('currentGridLabel').textContent = `Grid (${powerHours}hrs)`;
    document.getElementById('fullDayGridCost').textContent = `â‚¦${formatNumber(fullDayGridCost)}`;
    document.getElementById('bandACost').textContent = `â‚¦${formatNumber(bandACost)}`;

    // Calculate generator costs if enabled
	let generatorCosts = { monthly: 0, maintenance: 0, total: 0 };

	if (useGenerator) {
		const fuelCosts = updateGeneratorCosts();
		const maintenance = parseFloat(document.getElementById('generatorMaintenance')?.value) || 10000;
		
		generatorCosts = {
			monthly: fuelCosts.monthly,
			maintenance: maintenance,
			total: fuelCosts.monthly + maintenance
		};
		
		// Update generator cost displays
		document.getElementById('genMonthlyCost').textContent = `â‚¦${formatNumber(generatorCosts.monthly)}`;
		document.getElementById('genMaintenanceCost').textContent = `â‚¦${formatNumber(generatorCosts.maintenance)}`;
		document.getElementById('genTotalCost').textContent = `â‚¦${formatNumber(generatorCosts.total)}`;
	} else {
		// Reset generator displays when not active
		const genMonthlyCost = document.getElementById('genMonthlyCost');
		const genMaintenanceCost = document.getElementById('genMaintenanceCost');
		const genTotalCost = document.getElementById('genTotalCost');
		
		if (genMonthlyCost) genMonthlyCost.textContent = `â‚¦0`;
		if (genMaintenanceCost) genMaintenanceCost.textContent = `â‚¦0`;
		if (genTotalCost) genTotalCost.textContent = `â‚¦0`;
	}

    // Calculate total costs (only include generator if enabled)
	const totalMonthly = currentGridCost + (useGenerator ? generatorCosts.total : 0);
	const totalAnnual = totalMonthly * 12;

    // Update total displays
    document.getElementById('totalMonthlyCost').textContent = `â‚¦${formatNumber(totalMonthly)}`;
    document.getElementById('totalAnnualCost').textContent = `â‚¦${formatNumber(totalAnnual)}`;

    // Store for later use (including generator data)
    appState.costEstimate = {
        band: band,
        rate: tariff.rate,
        powerHours: powerHours,
        currentGridCost: currentGridCost,
        fullDayGridCost: fullDayGridCost,
        bandACost: bandACost,
        monthlyKwh: adjustedMonthlyKwh,
        useGenerator: useGenerator,
        generator: useGenerator ? {
            size: document.getElementById('generatorSize')?.value || '2.5',
            fuelType: document.getElementById('fuelType')?.value || 'petrol',
            fuelPrice: parseFloat(document.getElementById('fuelPrice')?.value) || 700,
            litresPerFill: parseFloat(document.getElementById('litresPerFill')?.value) || 10,
            fillsPerWeek: parseFloat(document.getElementById('fillsPerWeek')?.value) || 2,
            hoursPerDay: parseFloat(document.getElementById('generatorHoursSlider')?.value) || 5,
            monthlyFuelCost: generatorCosts.monthly,
            maintenanceCost: generatorCosts.maintenance,
            totalMonthlyCost: generatorCosts.total
        } : null,
        totalMonthlyCost: totalMonthly,
        totalAnnualCost: totalAnnual
    };
}

function formatNumber(num) {
    return Math.round(num).toLocaleString();
}

function updateSliderValue(slider, displayId) {
    document.getElementById(displayId).textContent = slider.value;
}

// ==========================================
// SOLAR SYSTEM SIZING CALCULATIONS
// ==========================================
function calculateSystemSize(loadWatts, dailyKwh, backupHours) {
    // Inverter sizing (1.25x for safety margin, round to standard sizes)
    const inverterWatts = loadWatts * 1.25;
    const inverterKva = getStandardInverterSize(inverterWatts / 1000);
    
    // Battery sizing
    // Battery Wh = (Daily kWh * 1000 * Backup Factor) / (DoD * Efficiency)
    const dod = 0.5; // 50% depth of discharge for longevity
    const efficiency = 0.85;
    const batteryWh = (dailyKwh * 1000 * (backupHours / 24)) / (dod * efficiency);
    
    // Standard battery sizes
    const batteryVoltage = inverterKva >= 5 ? 48 : (inverterKva >= 3 ? 48 : 24);
    const batteryAh = batteryWh / batteryVoltage;
    const batterySize = batteryAh > 150 ? '200Ah' : '100Ah';
    const singleBatteryAh = batterySize === '200Ah' ? 200 : 100;
    const batteriesInParallel = Math.ceil(batteryAh / singleBatteryAh);
    const batteriesInSeries = batteryVoltage / 12;
    const batteryCount = Math.max(batteriesInParallel * batteriesInSeries, 2);
    
    // Solar panel sizing
    const peakSunHours = 5; // Average for Nigeria
    const systemLosses = 0.8;
    const panelKw = dailyKwh / (peakSunHours * systemLosses);
    const panelSize = 450; // Standard panel wattage
    const panelCount = Math.max(Math.ceil((panelKw * 1000) / panelSize), 2);
    
    // Cost estimation (Nigerian market prices 2024)
    const inverterCostPerKva = 180000; // â‚¦180,000 per kVA for quality inverter
    const batteryCost = batterySize === '200Ah' ? 280000 : 150000; // Per 12V battery
    const panelCostPerWatt = 350; // â‚¦350 per watt
    const installationPercent = 0.15;
    const accessoriesCost = 100000; // Cables, breakers, mounting, etc.
    
    const equipmentCost = 
        (inverterKva * inverterCostPerKva) + 
        (batteryCount * batteryCost) + 
        (panelCount * panelSize * panelCostPerWatt) +
        accessoriesCost;
    
    const installationCost = equipmentCost * installationPercent;
    const totalCost = equipmentCost + installationCost;
    
    // Calculate actual backup hours
    const actualBackupHours = Math.round((batteryCount * singleBatteryAh * 12 * dod * efficiency) / loadWatts);

    return {
        inverterKva: inverterKva,
        batteryCount: batteryCount,
        batterySize: batterySize,
        batteryVoltage: batteryVoltage + 'V',
        panelCount: panelCount,
        panelSize: panelSize,
        totalPanelKw: (panelCount * panelSize / 1000).toFixed(1),
        backupHours: Math.min(actualBackupHours, 24),
        cost: totalCost,
        paybackYears: 0,
        monthlySavings: 0,
        annualSavings: 0,
        remainingGridCost: 0
    };
}

function getStandardInverterSize(kva) {
    const standardSizes = [1, 1.5, 2, 2.5, 3, 3.5, 5, 7.5, 10, 15, 20];
    for (const size of standardSizes) {
        if (kva <= size) return size;
    }
    return Math.ceil(kva);
}

function getEquipmentTip(equipmentName) {
    const name = equipmentName.toLowerCase();
    if (name.includes('ac') || name.includes('air conditioner')) {
        return 'Consider upgrading to an inverter AC for 40-60% energy savings.';
    } else if (name.includes('refrigerator') || name.includes('fridge')) {
        return 'An inverter refrigerator can reduce consumption by up to 50%.';
    } else if (name.includes('water heater')) {
        return 'Solar water heaters can eliminate this load entirely.';
    } else if (name.includes('freezer')) {
        return 'Ensure proper insulation and avoid opening frequently.';
    }
    return 'Consider energy-efficient alternatives when replacing.';
}

// ==========================================
// STEP 6: SOLAR RECOMMENDATIONS (UPDATED WITH GENERATOR ROI)
// ==========================================
function generateSolarRecommendations() {
    const container = document.getElementById('solar-recommendations');
	
	// ADD: Ensure analysis exists
    if (!appState.analysis) {
        generateAnalysisDashboard(); // Generate it if missing
    }
	
    const analysis = appState.analysis || calculateEnergyAnalysis();
    const costData = appState.costEstimate || {};
    const solar = calculateSolarRequirements(analysis, costData);

    // Store for later
    appState.solarRecommendation = solar;

    const useGenerator = costData.useGenerator;
    const generatorData = costData.generator;

    container.innerHTML = `
        <!-- Current Energy Cost Summary -->
        <div class="breakdown-chart" style="margin-bottom: 20px;">
            <h3 class="chart-title"><i class="fas fa-money-bill-wave"></i> Your Current Energy Costs</h3>
            <div class="current-costs-grid">
                <div class="cost-item">
                    <i class="fas fa-plug" style="color: var(--secondary);"></i>
                    <div class="cost-details">
                        <span class="cost-label">Grid Electricity</span>
                        <span class="cost-value">â‚¦${formatNumber(costData.currentGridCost || 0)}/month</span>
                    </div>
                </div>
                ${useGenerator ? `
                <div class="cost-item">
                    <i class="fas fa-gas-pump" style="color: var(--warning);"></i>
                    <div class="cost-details">
                        <span class="cost-label">Generator (Fuel + Maintenance)</span>
                        <span class="cost-value">â‚¦${formatNumber(generatorData?.totalMonthlyCost || 0)}/month</span>
                    </div>
                </div>
                ` : ''}
                <div class="cost-item total">
                    <i class="fas fa-calculator" style="color: var(--danger);"></i>
                    <div class="cost-details">
                        <span class="cost-label">Total Monthly Cost</span>
                        <span class="cost-value" style="color: var(--danger); font-size: 1.2rem;">â‚¦${formatNumber(costData.totalMonthlyCost || 0)}/month</span>
                    </div>
                </div>
                <div class="cost-item total">
                    <i class="fas fa-calendar-alt" style="color: var(--danger);"></i>
                    <div class="cost-details">
                        <span class="cost-label">Total Annual Cost</span>
                        <span class="cost-value" style="color: var(--danger); font-size: 1.2rem;">â‚¦${formatNumber(costData.totalAnnualCost || 0)}/year</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Option 1: Essential Backup -->
        <div class="solar-card">
            <div class="solar-header">
                <div class="solar-icon">âš¡</div>
                <div>
                    <h3 class="solar-title">Essential Backup System</h3>
                    <p class="solar-subtitle">Powers lights, fans, TV, phone charging, and small appliances</p>
                </div>
            </div>
            <div class="solar-specs">
                <div class="spec-item">
                    <div class="spec-value">${solar.essential.inverterKva} kVA</div>
                    <div class="spec-label">Inverter Size</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value">${solar.essential.batteryCount} Ã— ${solar.essential.batterySize}</div>
                    <div class="spec-label">Battery Bank</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value">${solar.essential.panelCount} Ã— ${solar.essential.panelSize}W</div>
                    <div class="spec-label">Solar Panels</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value">â‚¦${formatNumber(solar.essential.cost)}</div>
                    <div class="spec-label">Est. Cost</div>
                </div>
            </div>
            <div class="solar-details" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                <p style="font-size: 0.9rem; color: var(--gray);">
                    <i class="fas fa-clock" style="color: var(--primary);"></i> 
                    Backup Duration: <strong>${solar.essential.backupHours} hours</strong> at essential load
                </p>
            </div>
        </div>

        <!-- Option 2: Full Home -->
        <div class="solar-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border-color: rgba(59, 130, 246, 0.3);">
            <div class="solar-header">
                <div class="solar-icon" style="background: rgba(59, 130, 246, 0.2);">ðŸ”‹</div>
                <div>
                    <h3 class="solar-title">Full Home Power System</h3>
                    <p class="solar-subtitle">Powers everything including AC, refrigerator & heavy appliances</p>
                </div>
            </div>
            <div class="solar-specs">
                <div class="spec-item">
                    <div class="spec-value" style="color: #3b82f6;">${solar.full.inverterKva} kVA</div>
                    <div class="spec-label">Inverter Size</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value" style="color: #3b82f6;">${solar.full.batteryCount} Ã— ${solar.full.batterySize}</div>
                    <div class="spec-label">Battery Bank</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value" style="color: #3b82f6;">${solar.full.panelCount} Ã— ${solar.full.panelSize}W</div>
                    <div class="spec-label">Solar Panels</div>
                </div>
                <div class="spec-item">
                    <div class="spec-value" style="color: #3b82f6;">â‚¦${formatNumber(solar.full.cost)}</div>
                    <div class="spec-label">Est. Cost</div>
                </div>
            </div>
            <div class="solar-details" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                <p style="font-size: 0.9rem; color: var(--gray);">
                    <i class="fas fa-clock" style="color: #3b82f6;"></i> 
                    Backup Duration: <strong>${solar.full.backupHours} hours</strong> at full load
                </p>
            </div>
        </div>

        <!-- Key Insights -->
        <div class="breakdown-chart">
            <h3 class="chart-title"><i class="fas fa-info-circle"></i> Key Insights</h3>
            <ul style="list-style: none; padding: 0;">
                ${generateSolarInsights(analysis, solar, costData)}
            </ul>
        </div>

        <!-- Enhanced ROI Calculator -->
        <div class="breakdown-chart" style="margin-top: 20px;">
            <h3 class="chart-title"><i class="fas fa-calculator"></i> Return on Investment Analysis</h3>
            
            <div class="roi-comparison">
                <div class="roi-section">
                    <h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-bolt"></i> Essential System ROI</h4>
                    <div class="roi-grid">
                        <div class="roi-item">
                            <span class="roi-label">System Cost</span>
                            <span class="roi-value" style="color: var(--light);">â‚¦${formatNumber(solar.essential.cost)}</span>
                        </div>
                        <div class="roi-item">
                            <span class="roi-label">Monthly Savings</span>
                            <span class="roi-value">â‚¦${formatNumber(solar.essential.monthlySavings)}</span>
                        </div>
                        <div class="roi-item">
                            <span class="roi-label">Annual Savings</span>
                            <span class="roi-value">â‚¦${formatNumber(solar.essential.annualSavings)}</span>
                        </div>
                        <div class="roi-item highlight">
                            <span class="roi-label">Payback Period</span>
                            <span class="roi-value">${solar.essential.paybackYears} years</span>
                        </div>
                    </div>
                </div>
                
                <div class="roi-section" style="margin-top: 20px;">
                    <h4 style="color: #3b82f6; margin-bottom: 15px;"><i class="fas fa-home"></i> Full System ROI</h4>
                    <div class="roi-grid">
                        <div class="roi-item">
                            <span class="roi-label">System Cost</span>
                            <span class="roi-value" style="color: var(--light);">â‚¦${formatNumber(solar.full.cost)}</span>
                        </div>
                        <div class="roi-item">
                            <span class="roi-label">Monthly Savings</span>
                            <span class="roi-value">â‚¦${formatNumber(solar.full.monthlySavings)}</span>
                        </div>
                        <div class="roi-item">
                            <span class="roi-label">Annual Savings</span>
                            <span class="roi-value">â‚¦${formatNumber(solar.full.annualSavings)}</span>
                        </div>
                        <div class="roi-item highlight">
                            <span class="roi-label">Payback Period</span>
                            <span class="roi-value">${solar.full.paybackYears} years</span>
                        </div>
                    </div>
                </div>
            </div>
            
            ${useGenerator ? `
            <div class="ai-bubble" style="margin-top: 20px;">
                <p>ðŸ”¥ <strong>Generator Savings:</strong> By going solar, you'll eliminate your generator fuel costs of <strong>â‚¦${formatNumber(generatorData?.monthlyFuelCost || 0)}/month</strong> (â‚¦${formatNumber((generatorData?.monthlyFuelCost || 0) * 12)}/year), plus maintenance costs. This significantly improves your ROI!</p>
            </div>
            ` : ''}
            
            <!-- 5-Year Projection -->
            <div class="projection-section" style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <h4 style="margin-bottom: 15px;"><i class="fas fa-chart-line"></i> 5-Year Cost Projection</h4>
                <div class="projection-grid">
                    <div class="projection-item current">
                        <span class="projection-label">Current Setup (No Solar)</span>
                        <span class="projection-value" style="color: var(--danger);">â‚¦${formatNumber(costData.totalAnnualCost * 5)}</span>
                        <span class="projection-note">Over 5 years</span>
                    </div>
                    <div class="projection-item solar">
                        <span class="projection-label">With Essential Solar</span>
                        <span class="projection-value" style="color: var(--success);">â‚¦${formatNumber(solar.essential.cost + (solar.essential.remainingGridCost * 5 * 12))}</span>
                        <span class="projection-note">System + minimal grid</span>
                    </div>
                    <div class="projection-item solar">
                        <span class="projection-label">With Full Solar</span>
                        <span class="projection-value" style="color: var(--primary);">â‚¦${formatNumber(solar.full.cost + (solar.full.remainingGridCost * 5 * 12))}</span>
                        <span class="projection-note">System + minimal grid</span>
                    </div>
                </div>
                <div class="savings-highlight" style="margin-top: 15px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3);">
                    <p style="text-align: center;">
                        <strong style="color: var(--success); font-size: 1.1rem;">ðŸ’° 5-Year Savings with Full Solar:</strong><br>
                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--success);">â‚¦${formatNumber((costData.totalAnnualCost * 5) - (solar.full.cost + (solar.full.remainingGridCost * 5 * 12)))}</span>
                    </p>
                </div>
            </div>
        </div>
    `;
}

function calculateSolarRequirements(analysis, costData) {
    const dailyKwh = analysis.dailyKwh || 15;
    const peakLoad = analysis.peakLoad || 2000;
    const baseLoad = analysis.baseLoad || 500;
    
    // Essential load (lights, fans, TV, router, chargers) - typically 30% of total
    const essentialLoad = Math.max(baseLoad * 1.5, peakLoad * 0.3);
    const essentialDailyKwh = dailyKwh * 0.4;
    
    // Full load
    const fullLoad = peakLoad;
    const fullDailyKwh = dailyKwh;

    // Calculate systems
    const essential = calculateSystemSize(essentialLoad, essentialDailyKwh, 8);
    const full = calculateSystemSize(fullLoad, fullDailyKwh, 6);

    // Calculate savings based on current costs (grid + generator)
    const totalMonthlyCost = costData.totalMonthlyCost || (dailyKwh * 30 * 100);
    const generatorMonthlyCost = costData.generator?.totalMonthlyCost || 0;
    
    // Essential system savings (assumes 60% reduction in grid dependency, eliminates most generator use)
    const essentialGridSavings = (costData.currentGridCost || 0) * 0.6;
    const essentialGenSavings = generatorMonthlyCost * 0.7; // 70% reduction in generator use
    essential.monthlySavings = essentialGridSavings + essentialGenSavings;
    essential.annualSavings = essential.monthlySavings * 12;
    essential.remainingGridCost = (costData.currentGridCost || 0) * 0.4;
    essential.paybackYears = essential.monthlySavings > 0 
        ? (essential.cost / essential.annualSavings).toFixed(1) 
        : 'N/A';

    // Full system savings (assumes 90% reduction in grid dependency, eliminates generator)
    const fullGridSavings = (costData.currentGridCost || 0) * 0.9;
    const fullGenSavings = generatorMonthlyCost; // 100% elimination
    full.monthlySavings = fullGridSavings + fullGenSavings;
    full.annualSavings = full.monthlySavings * 12;
    full.remainingGridCost = (costData.currentGridCost || 0) * 0.1;
    full.paybackYears = full.monthlySavings > 0 
        ? (full.cost / full.annualSavings).toFixed(1) 
        : 'N/A';

    return {
        essential,
        full,
        totalCurrentMonthlyCost: totalMonthlyCost,
        dailyKwh,
        peakLoad
    };
}

function generateSolarInsights(analysis, solar, costData) {
    const insights = [];
    const useGenerator = costData.useGenerator;
    const generatorData = costData.generator;
    
    // Generator insight
    if (useGenerator && generatorData) {
        insights.push({
            icon: 'fa-gas-pump',
            color: 'var(--warning)',
            text: `You're spending <strong>â‚¦${formatNumber(generatorData.monthlyFuelCost)}/month</strong> on generator fuel alone. Solar can eliminate this cost entirely!`
        });
    }
    
    // Find highest consuming equipment
    if (analysis.breakdown && analysis.breakdown.length > 0) {
        const topConsumer = analysis.breakdown[0];
        if (topConsumer.percentage > 40) {
            insights.push({
                icon: 'fa-exclamation-triangle',
                color: 'var(--warning)',
                text: `Your <strong>${topConsumer.name}</strong> accounts for ${topConsumer.percentage.toFixed(0)}% of consumption. ${getEquipmentTip(topConsumer.name)}`
            });
        }
    }

    // ROI insight
    insights.push({
        icon: 'fa-chart-line',
        color: 'var(--success)',
        text: `With the full solar system, you'll save <strong>â‚¦${formatNumber(solar.full.annualSavings)}</strong> annually and break even in <strong>${solar.full.paybackYears} years</strong>`
    });

    // Battery recommendation
    insights.push({
        icon: 'fa-battery-full',
        color: 'var(--primary)',
        text: `Lithium batteries (LiFePO4) recommended for 10+ years lifespan vs 3-5 years for lead-acid`
    });

    // Panel efficiency
    insights.push({
        icon: 'fa-solar-panel',
        color: 'var(--secondary)',
        text: `Monocrystalline panels recommended for better efficiency in limited space`
    });

    return insights.map(insight => `
        <li style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <i class="fas ${insight.icon}" style="color: ${insight.color}; margin-right: 10px;"></i>
            ${insight.text}
        </li>
    `).join('');
}

// ==========================================
// STEP 7: FORM SUBMISSION
// ==========================================
function submitForm() {
    const name = document.getElementById('userName').value.trim();
    const email = document.getElementById('userEmail').value.trim();
    const phone = document.getElementById('userPhone').value.trim();

    if (!name || !email || !phone) {
        alert('Please fill in all fields');
        return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
    }

    appState.contactInfo = { name, email, phone };

    // Compile complete report data
    const reportData = {
        contactInfo: appState.contactInfo,
        houseType: appState.houseType,
        equipment: appState.equipment,
        usagePatterns: appState.usagePatterns,
        analysis: appState.analysis,
        costEstimate: appState.costEstimate,
        solarRecommendation: appState.solarRecommendation,
        timestamp: new Date().toISOString()
    };

    console.log('Complete Report Data:', reportData);

    // Show success
    document.getElementById('step7').querySelector('.card').innerHTML = `
        <div style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ðŸŽ‰</div>
            <h2 class="card-title" style="justify-content: center;">Report Sent Successfully!</h2>
            <p class="card-subtitle">Check your email for your personalized energy report</p>
            
            <div class="ai-bubble">
                <p>Thank you for using EnergiX, <strong>${name}</strong>! Your comprehensive energy report has been sent to <strong>${email}</strong>.</p>
            </div>

            <div class="solar-card" style="text-align: left;">
                <h3 style="margin-bottom: 15px;">ðŸ“‹ Your Report Summary:</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 8px 0;">âœ… House Type: <strong>${formatHouseType(appState.houseType)}</strong></li>
                    <li style="padding: 8px 0;">âœ… Equipment Analyzed: <strong>${Object.keys(appState.equipment).length} items</strong></li>
                    <li style="padding: 8px 0;">âœ… Daily Consumption: <strong>${appState.analysis?.dailyKwh?.toFixed(2) || 'N/A'} kWh</strong></li>
                    <li style="padding: 8px 0;">âœ… Monthly Estimate: <strong>${appState.analysis?.monthlyKwh?.toFixed(0) || 'N/A'} kWh</strong></li>
                    <li style="padding: 8px 0;">âœ… Estimated Monthly Cost: <strong>â‚¦${formatNumber(appState.costEstimate?.totalMonthlyCost || 0)}</strong></li>
                </ul>
            </div>
            
            <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 20px;">
                <i class="fas fa-redo"></i> Start New Analysis
            </button>
        </div>
    `;

    document.getElementById('progressFill').style.width = '100%';

    // In production, send to backend
    // sendToBackend(reportData);
}

function formatHouseType(type) {
    const types = {
        'self-contain': 'Self Contain',
        '1-room-parlor': '1 Room & Parlor',
        '2-bedroom': '2 Bedroom Flat',
        '3-bedroom': '3 Bedroom Flat',
        '4-bedroom': '4 Bedroom',
        'duplex': 'Duplex',
        'bungalow': 'Bungalow',
        'office': 'Office Space'
    };
    return types[type] || type || 'Not specified';
}

// ==========================================
// NAVIGATION UPDATE - Add step-specific initialization
// ==========================================

// Add localStorage persistence
function saveState() {
    try {
        localStorage.setItem('energix_state', JSON.stringify(appState));
    } catch (e) {
        console.warn('Could not save state:', e);
    }
}

function loadState() {
    try {
        const saved = localStorage.getItem('energix_state');
        if (saved) {
            const parsed = JSON.parse(saved);
            Object.assign(appState, parsed);
            return true;
        }
    } catch (e) {
        console.warn('Could not load state:', e);
    }
    return false;
}

// Call on page load
document.addEventListener('DOMContentLoaded', function() {
    if (loadState()) {
        // Restore UI state
        restoreUIFromState();
    }
});

// Call after each step
function goToStep(step) {
    // Show loading for heavy calculations
    if (step === 4 || step === 6) {
        showLoadingState(step);
    }
	
    // Validate before moving forward
    if (step > currentStep) {
        if (!validateCurrentStep()) {
            return;
        }
    }

    // Hide current step
    document.getElementById(`step${currentStep}`).classList.remove('active');
    
    // Show new step
    document.getElementById(`step${step}`).classList.add('active');
    
    // Update progress bar
    const progress = (step / totalSteps) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;
    
    // Update step circles
    updateStepCircles(step);
    
    // Update current step tracker
    currentStep = step;
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });

    // Step-specific initialization
    switch(step) {
        case 3:
            generateUsagePatterns();
            break;
        case 4:
            generateAnalysisDashboard();
            break;
        case 5:
            initializeStep5();
            break;
        case 6:
            generateSolarRecommendations();
            break;
    }
}
    saveState();
}

function showLoadingState(step) {
    const container = document.getElementById(`step${step}`);
    const card = container.querySelector('.card');
    const originalContent = card.innerHTML;
    
    card.innerHTML = `
        <div style="text-align: center; padding: 40px;">
            <div class="typing-indicator" style="justify-content: center;">
                <span></span><span></span><span></span>
            </div>
            <p style="margin-top: 20px; color: var(--gray);">Calculating your energy profile...</p>
        </div>
    `;
    
    // Restore after calculation (use Promise or callback in real implementation)
    setTimeout(() => {
        card.innerHTML = originalContent;
    }, 100);
}

// ==========================================
// UTILITY FUNCTIONS
// ==========================================
// debounce utility
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Use for sliders that trigger heavy calculations
const debouncedUpdateCosts = debounce(updateAllCosts, 150);

// In initializeStep5():
if (powerHoursSlider) {
    powerHoursSlider.addEventListener('input', function() {
        document.getElementById('power-hours-display').textContent = this.value;
        debouncedUpdateCosts(); // Use debounced version
    });
}

    </script>
</body>
</html>
